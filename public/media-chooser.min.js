/*! Chute.MediaChooser - v0.1.1 - 2012-08-07
* http://getchute.com/
* Copyright (c) 2012 Chute Corporation; Licensed MIT */
function chutelog(a){try{console.log(a)}catch(b){}finally{return}}function chuteGetScript(a,b){var c=document.createElement("script");c.src=a;var d=document.getElementsByTagName("head")[0],e=!1;c.onload=c.onreadystatechange=function(){!e&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(e=!0,b(),c.onload=c.onreadystatechange=null,d.removeChild(c))},d.appendChild(c)}window.Chute||(window.Chute=function(){function a(){}return a.setApp=function(a){this.app=a},a.fill=function(a,b,c){return""+c+"/"+a+"x"+b},a.fit=function(a,b,c){return""+c+"/fit/"+a+"x"+b},a.width=function(a,b){return""+b+"/w/"+a},a.height=function(a,b){return""+b+"/h/"+a},a}()),window.Chute.MediaChooser=function(){function a(){}return a.validateNumber=function(a,b){var c,d,e,f,g;e=-Infinity,f=!1,c=Infinity,d=!1,g=/>=\s?([0-9.]+)/.exec(b),g&&(e=parseFloat(g[1]),f=!0),g=/>\s?([0-9.]+)/.exec(b),g&&(e=parseFloat(g[1]),f=!1),g=/<=\s?([0-9.]+)/.exec(b),g&&(c=parseFloat(g[1]),d=!0),g=/<\s?([0-9.]+)/.exec(b),g&&(c=parseFloat(g[1]),d=!1),g=/^\=\s?([0-9.]+)$/.exec(b),g&&(e=c=parseFloat(g[1]),f=d=!0);if(e!==-Infinity)if(f){if(!(a>=e))return!1}else if(!(a>e))return!1;if(c!==Infinity)if(d){if(!(a<=c))return!1}else if(!(a<c))return!1;return!0},a.defaults={},a.setDefaults=function(a){this.defaults=a!=null?a:{}},a.choose=function(a,b){var c,d,e,f,g=this;"function"==typeof a&&(b=a,a={}),a.app=Chute.app||a.app||this.defaults.app,a.chute_id=a.album||this.defaults.album;if(!a.app)throw new Error("Chute.MediaChooser requires app parameter");a.chute_id&&(a.identifier="chute-identifier-"+a.chute_id),a.mode==null&&(a.mode="collector"),a.popup==null&&(a.popup=this.defaults.popup),a.file_types=function(){switch(a.mediaTypes||this.defaults.mediaTypes){case"images":case"image":case"picture":case"pictures":return 1;case"video":case"videos":return 2;default:return 0}}.call(this),a.file_limit=a.limit||this.defaults.limit||0,a.picker_version="v2",c=0,this.defaults.constraints&&!a.constraints&&(a.constraints=this.defaults.constraints);if(a.constraints)for(e in a.constraints)a.constraints.hasOwnProperty(e)&&c++;return a.onSelectionComplete=function(d,f){var h,i,j,k,l,m,n;j=[],i={};for(e in f)f.hasOwnProperty(e)&&(i[e]=f[e]);i.assets=[],n=f.assets;for(l=0,m=n.length;l<m;l++){h=n[l];if(c>0){k=!0;for(e in a.constraints)a.constraints.hasOwnProperty(e)&&!g.validateNumber(h[e],a.constraints[e])&&(k=!1);k&&(i.assets.push(h),j.push(h.url))}else i.assets.push(h),j.push(h.url)}if(b)return b(j,i)},d=parseInt(Math.random()*1e3),f=jQuery('<div id="chute-'+d+'"></div>'),f.appendTo("body"),a.widget_id=d,a.onComplete=function(){var b;return b=f.find("a.chute-browseButton"),!a.popup&&a.mode==="collector"&&b.hide(),b.click()},chute("#chute-"+d,a)},a}();var currentWidget=null,$chuteWidget,chute=function(a,b){function c(a,b){_chuteFunctions(),jQuery(a).chute(b)}typeof jQuery!="undefined"&&c(a,b);var d=function(){typeof jQuery=="undefined"?chuteGetScript("//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js",function(){setTimeout(function(){c(a,b)},10)}):c(a,b)},e=function(){document.readyState=="complete"&&d()};typeof jQuery=="undefined"&&(document.readyState=="complete"?d():document.addEventListener?document.addEventListener("readystatechange",e):document.attachEvent("onreadystatechange",e))},_chuteFunctions=function(){(function($){var CHUTE={popupHtml:"<div class='chute-popup chute-reveal-modal'>        <iframe width='100%' height='100%' marginWidth='0' marginHeight='0' frameBorder='0' scrolling='no' title='' src='//s3.amazonaws.com/cdn.getchute.com/html/v1/loading.html'>IFrame not supported</iframe>        <a class='close-chute-reveal-modal'>&#215;</a>      </div>      <div class='chute-thanks chute-reveal-modal'>        <div class='chute-thanks-header'>          <h3>Thanks!</h3>          <p>Your photos will be online as soon as they're approved</p>        </div>        <div class='chute-thanks-footer'>          <a href='mailto:info@getchute.com'>info@getchute.com</a>        </div>        <a class='close-chute-reveal-modal'>&nbsp;</a>      </div>",defaultDisplayTemplateHtml:"<style type='text/css'>.chute-thumbnails a{margin: 5px}  .chute-thumbnails img{width:100px;height:100px;}  .chute-thumbnail-reveal-modal {visibility: hidden;top: 0;left: 50%;margin-left: -250px;width: 500px;max-height: 800px;position: fixed;z-index: 10001;background-color:#fff;-moz-box-shadow: 0 0 10px rgba(0,0,0,.4);-webkit-box-shadow: 0 0 10px rgba(0,0,0,.4);-box-shadow: 0 0 10px rgba(0,0,0,.4);overflow:hidden;}  .chute-thumbnail-reveal-modal img{width: 100%;float: left;}  .chute-thumbnail-reveal-modal .close-chute-thumbnail-reveal-modal {font-size: 22px;line-height: .5;position: absolute;top: 15px;right: 11px;color: #aaa;text-shadow: 0 -1px 1px rbga(0,0,0,.6);font-weight: bold;cursor: pointer;}  .chute-thumbnail-reveal-modal .chute-thumbnail-source{position:absolute;left: 0;bottom: 30px;background-color: #000;background-color: rgba(0,0,0, 0.6);color: #fff;padding: 5px;text-decoration: none;-moz-box-shadow: 0 0 5px #888;-webkit-box-shadow: 0 0 5px#888;box-shadow: 0 0 5px #888;}  .chute-reveal-modal-bg {position: fixed;height: 100%;width: 100%;background: #000;background: rgba(150,150,150,.8);z-index: 10000;display: none;top: 0;left: 0;}</style><div class='chute-thumbnails'>{{#images}}<a href='{{url}}' data-source-url='{{source_url}}' data-url='{{url}}'><img src='{{url}}/100x100'></a>{{/images}}</div>",defaultCollectTemplateHtml:"<a href='#' class='chute-browseButton'><img src='//s3.amazonaws.com/cdn.getchute.com/v1/images/add-photos.png' style='border:0'></a>",paths:{assets:"/assets/:id",gallery:"/chutes/:id.js",collection:"/collection/:id"},defaults:{uploadServer:"//upload.getchute.com",apiServer:"//api.getchute.com",cdnRoot:"//s3.amazonaws.com/cdn.getchute.com/v1",popup:!1,app:null,disable_auto_identifier:!1,display_template_name:null,display_template:null,collector_template_name:null,collector_template:null,collector_width:"635px",collector_height:"435px",template_options:{},assets:null,gallery:null,collection:null,css:"",css_loaded:!1,scripts:"",scripts_lodaed:!1,exclusions:"",file_types:1,file_limit:0,is_display:!0,onComplete:function(){},onTemplateLoaded:function(){},onDependenciesLoaded:function(){},onAssetsLoading:function(){},onAssetsLoaded:function(){},onAssetsRendered:null,onAssetsReRendered:function(){},onDrop:function(){},onAlbumList:function(){},onAlbumLoad:function(){},onAdd:function(){},onRemove:function(){},onSelection:function(){},onConfirmation:function(){},onProfileComplete:function(){},onSelectionComplete:function(){}},init:function(a,b){this.$element=$(a),this.$element.addClass("chute-loaded");var c={app:this.$element.attr("data-app-id"),identifier:this.$element.attr("data-identifier")==undefined||this.$element.attr("data-identifier")==""?null:this.$element.attr("data-identifier"),disable_auto_identifier:this.$element.attr("data-disable-auto-identifier")==undefined?this.defaults.disable_auto_identifier:!0,id:this.$element.attr("data-id")==undefined?null:this.$element.attr("data-id"),bundle_id:this.$element.attr("data-bundle-id")==undefined?"":this.$element.attr("data-bundle-id"),assets:this.$element.attr("data-assets")==undefined?this.defaults.assets:this.$element.attr("data-assets").split(","),name:this.$element.attr("data-name"),url:this.$element.attr("data-url")==undefined?document.location.href:this.$element.attr("data-url"),tags:this.$element.attr("data-tags"),css:this.$element.attr("data-css")==undefined?"":this.$element.attr("data-css"),screens:this.$element.attr("data-screens")==undefined?"":this.$element.attr("data-screens"),display_template_name:this.$element.attr("data-display-template-name")==undefined?this.defaults.display_template_name:this.$element.attr("data-display-template-name"),display_template:this.$element.attr("data-display-template")==undefined?this.defaults.display_template:this.$element.attr("data-display-template"),collector_template_name:this.$element.attr("data-collector-template-name")==undefined?this.defaults.collector_template_name:this.$element.attr("data-collector-template-name"),collector_template:this.$element.attr("data-collector-template")==undefined?this.defaults.collector_template:this.$element.attr("data-collector-template"),collector_width:this.$element.attr("data-collector-width")==undefined?this.defaults.collector_width:this.$element.attr("data-collector-width"),collector_height:this.$element.attr("data-collector-height")==undefined?this.defaults.collector_height:this.$element.attr("data-collector-height"),template_options:this.$element.attr("data-template-options")==undefined?this.defaults.template_options:$.parseJSON(this.$element.attr("data-template-options")),captions:this.$element.attr("data-captions")==undefined?"hide":this.$element.attr("data-captions"),exclusions:this.$element.attr("data-services-exclude")==undefined?this.defaults.exclusions:this.$element.attr("data-services-exclude"),inclusions:this.$element.attr("data-services-include")==undefined?"":this.$element.attr("data-services-include"),dialogTitle:this.$element.attr("data-chooser-button-text")==undefined?"Choose Photos":this.$element.attr("data-chooser-button-text"),mode:this.$element.attr("data-mode")==undefined?"thumbnails":this.$element.attr("data-mode"),uploadServer:this.$element.attr("data-uploadServer")==undefined?this.defaults.uploadServer:this.$element.attr("data-uploadServer"),apiServer:this.$element.attr("data-apiServer")==undefined?this.defaults.apiServer:this.$element.attr("data-apiServer"),cdnRoot:this.$element.attr("data-cdnRoot")==undefined?this.defaults.cdnRoot:this.$element.attr("data-cdnRoot"),file_types:this.$element.attr("data-file-types")==undefined?this.defaults.file_types:this.$element.attr("data-file-types"),file_limit:this.$element.attr("data-file-limit")==undefined?this.defaults.file_limit:this.$element.attr("data-file-limit"),share_text:this.$element.attr("data-share-text")==undefined?"":this.$element.attr("data-share-text"),awesm_key:this.$element.attr("data-awesm-key")==undefined?"":this.$element.attr("data-awesm-key"),popup:this.$element.attr("data-popup")=="popup"};this.options=$.extend({},this.defaults,c),this.options=$.extend({},this.options,b),this.options.is_display=this.options.mode!="collector"&&this.options.mode!="chooser",this.options.identifier==null&&!this.options.disable_auto_identifier&&(this.options.identifier="",this.options.id="");if(!this.options.popup&&window!=window.top&&(document.location.host.indexOf("chute.com")==0||document.location.host.indexOf("slidechute.com")==0)||navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i))this.options.popup=!0;var d=this;d.$element.addClass("chute-base-widget").css("position","relative"),d.$element.data("options",this.options),d.$element.data("instanceReference",this);if(d.options.is_display){this.options.display_template==null&&this.options.display_template_name!=null&&(this.options.display_template=this.options.cdnRoot+"/templates/display/"+this.options.display_template_name+"/template.js");if(d.options.display_template&&d.options.display_template.indexOf("#")==0)d.options.display_template=$(d.options.display_template).html(),d.renderData();else if(this.options.display_template==undefined||this.options.display_template.indexOf("http")!=0&&this.options.display_template.indexOf("//")!=0){if(this.options.display_template_name==undefined||this.options.display_template_name=="default"||this.options.display_template_name=="")this.options.display_template=this.defaultDisplayTemplateHtml,this.options.onAssetsRendered=this.assetsRendered,d.renderData()}else $.getScript(d.options.display_template,function(){d.loadTemplateData(function(){d.options.onDependenciesLoaded(d.$element),d.renderData()})})}else this.options.collector_template==null&&this.options.collector_template_name==null?this.options.collector_template=this.defaultCollectTemplateHtml:this.options.collector_template==null&&(this.options.collector_template=this.options.cdnRoot+"/templates/collector/"+this.options.collector_template_name+"/template.js"),d.renderData();return d.options.onComplete(),d},renderData:function(a){var b=this;b.resetTimestamp();if(b.options.is_display){if(b.options.id==null&&b.options.identifier==null){b.$element.addClass("chute-disabled").css("opacity","0.5");return}b.options.onAssetsLoading(b.$element);var c=b.options.imagesUrl;if(b.options.assets){var d="";typeof b.options.assets=="string"&&(b.options.assets=b.options.assets.split(",")),b.options.assets[0].indexOf("http")==0?d="assets="+$.map(b.options.assets,function(a){var b=a.match("/m/([^/]+)/");return b.pop()}).join(","):d="assets="+b.options.assets.join(","),c+="&"+d}this.options.template_options.per_page&&(c+="&per_page="+this.options.template_options.per_page);var e=a==undefined?-1:a==b.options.nextImagesUrl?0:1,f=a?a:c;if(e==-1&&document.location.hash!=""&&document.location.hash!="#"){var g=document.location.hash.replace("#","");f=f+"&extra_assets="+g}b.loadPath(f,function(a){a.data.next_url&&e!=1&&(b.options.nextImagesUrl=a.data.next_url),e!=0&&(b.options.nextPageUrl=a.data.next_page_url,b.options.previousPageUrl=a.data.previous_page_url),a.data.assets.length>0&&b.options.onAssetsLoaded(b.$element,a)!=!1&&b.displayRender(a,e)})}else b.setupCollectorModal(),b.collectorRender(function(){b.$element.find(".chute-popup").css({width:b.options.collector_width,height:b.options.collector_height,"margin-left":"-"+parseInt(b.options.collector_width)/2+"px"});if(b.options.id==null&&b.options.identifier==null){b.$element.addClass("chute-disabled").css("opacity","0.5");return}b.makeDroppable(b.$element.find(".chutedrop"))})},hasNextPage:function(){return this.options.nextPageUrl!=undefined},hasPreviousPage:function(){return this.options.previousPageUrl!=undefined},hasNewPage:function(){return this.options.nextImagesUrl!=undefined},renderNextPage:function(){this.hasNextPage()&&this.renderData(this.options.nextPageUrl)},renderPreviousPage:function(){this.hasPreviousPage()&&this.renderData(this.options.previousPageUrl)},renderNewData:function(){this.hasNewPage()&&this.renderData(this.options.nextImagesUrl)},loadCSS:function(a){if(!a)return;typeof a=="string"?(a.indexOf("http")!=0&&(a=document.location.protocol+a),$("head").append('<link rel="stylesheet" type="text/css" href="'+a+'" />')):$.each(a,function(a,b){b.indexOf("http")!=0&&(b=document.location.protocol+b),$("head").append('<link rel="stylesheet" type="text/css" href="'+b+'" />')})},loadJS:function(a,b){if(!a){b();return}if(typeof a=="string")$.getScript(a,b);else if(a.length==0)b();else if(a.length==1)$.getScript(a[0],b);else{var c=a.length,d=[],e=0,f=0,g=function(){e++,e==c&&b()};for(;f<c;f++)d.push($.getScript(a[f],g))}},loadData:function(a){var b="";this.options.collection!=null?b=this.paths.collection.replace(":id",this.options.collection):this.options.gallery!=null?b=this.paths.gallery.replace(":id",this.options.gallery):this.options.assets!=null&&(b=this.paths.asset.replace(":id",this.options.asset));if(b.length){var c=this.paths.api+b;$.ajax({url:this.paths.api+b,dataType:"jsonp",success:function(a,b,c){},error:function(a){}})}},loadPath:function(a,b){$.ajax({url:a,dataType:"jsonp",success:function(a,c,d){b(a)},error:function(a){}})},loadTemplateData:function(callback){var me=this;this.options.is_display&&(this.options.display_template=eval(this.options.display_template_name+"_template_definition"),typeof this.options.display_template!="string"?(this.options=$.extend({},this.options,this.options.display_template.bindings),this.options.onTemplateLoaded(me.$element),me.loadCSS(this.options.display_template.requires.css),me.loadJS(this.options.display_template.requires.js,function(){callback()})):callback())},setupCollectorModal:function(){$("#chute-collector-modal").length||this.loadCSS(this.options.cdnRoot+"/css/c.css")},collectorRender:function(callback){var me=this;me.options.collector_template.indexOf("http")==0?$.getScript(me.options.collector_template,function(){me.$element.html(me.popupHtml+eval(me.options.collector_template_name+"_template_html")),callback()}):(me.$element.html(me.popupHtml+me.options.collector_template),callback())},collectorModal:function(){this.setupCollectorModal(),this.$element.click(function(a){a.preventDefault()})},makeDroppable:function(a){var b=this;b.$element.find(".chute-browseButton, .chute-dropBox").live("click",function(a){a.preventDefault(),b.openChuteBrowser()}),b.openChuteBrowser=function(){if(b.options.popup){var a=700,c=450,d=parseInt(screen.availWidth/2-a/2),e=parseInt(screen.availHeight/2-c/2),f="width="+a+",height="+c+",status,resizable,scrollbars=0,left="+d+",top="+e+"screenX="+d+",screenY="+e;window.open(b.options.browsePath,"chute_browse_popup",f)}else b.$element.find(".chute-popup iframe").attr("src",b.options.browsePath),b.$element.find(".chute-popup").chuteReveal();this.resetTimestamp(),currentWidget=b},b.$element.find(".chute-popup .close-chute-reveal-modal").click(function(){b.resetIframe()});if(a.length==0)return;var c=0,d=0,e=0,f="",g="",h="";b.options.file_types==0?(f="50MB",g="jpg,gif,png,jpeg,mov,mp4,mpeg,mpeg,avi",h="Media Files"):b.options.file_types==1?(f="5MB",g="jpg,gif,png,jpeg",h="Image Files"):(f="50MB",g="mov,mp4,mpeg,mpeg,avi",h="Video Files"),a.attr("id",b.options.timestamp);var i=new plupload.Uploader({runtimes:"html5,flash,silverlight",browse_button:"",container:b.options.timestamp,max_file_size:f,resize:{quality:90},url:b.options.uploadPath,flash_swf_url:"//s3.amazonaws.com/cdn.getchute.com/objects/v1/plupload.flash.swf",silverlight_xap_url:"//s3.amazonaws.com/cdn.getchute.com/objects/v1/plupload.silverlight.xap",filters:[{title:h,extensions:g}],drop_element:b.options.timestamp});i.bind("Init",function(a,c){setTimeout(function(){b.$element.find(".plupload.html5 input").attr("size",300)},100),b.$element.find(".chute-select-button").click(function(a){a.preventDefault(),b.openChuteBrowser()})}),$("#uploadfiles").click(function(a){i.start(),a.preventDefault()}),i.init(),i.bind("FilesAdded",function(a,d){b.options.onDrop(b.$element,d),b.setChuteFileProgress(0),$.each(d,function(a,b){c++}),a.refresh(),i.start()}),i.bind("UploadProgress",function(a,f){e=(f.percent+d*100)/c,b.setChuteFileProgress(e)}),i.bind("Error",function(a,b){alert("Files cannot be larger than "+f),a.refresh()}),i.bind("FileUploaded",function(a,f){d++,e=d*100/c,b.setChuteFileProgress(e)}),i.bind("UploadComplete",function(a,c){e=100,b.setChuteFileProgress(e),b.openChuteBrowser()}),b.setChuteFileProgress=function(a){a<100?b.$element.find(".chute-collector").addClass("chute-uploading"):b.$element.find(".chute-collector").removeClass("chute-uploading"),b.$element.find(".chute-uploadProgress .chute-bar").css("width",a+"%")}},resetTimestamp:function(){var a=new Date,b=(""+(a.getTime()-a.getMilliseconds())/1e3+"-"+Math.random()).replace("0.","");this.options.timestamp=b,this.options.uploadPath=this.options.uploadServer+"/upload"+"?timestamp="+encodeURIComponent(this.options.timestamp)+"&app_id="+encodeURIComponent(this.options.app)+"&id="+encodeURIComponent(this.options.id)+"&identifier="+encodeURIComponent(this.options.identifier)+"&title="+encodeURIComponent(this.options.name)+"&url="+encodeURIComponent(this.options.url)+"&tags="+encodeURIComponent(this.options.tags)+"&screens="+encodeURIComponent(this.options.screens)+"&css="+encodeURIComponent(this.options.css)+"&captions="+encodeURIComponent(this.options.captions)+"&exclusions="+encodeURIComponent(this.options.exclusions)+"&inclusions="+encodeURIComponent(this.options.inclusions),this.options.browsePath=this.options.uploadServer+"/payload/"+this.options.timestamp+"?app_id="+encodeURIComponent(this.options.app)+"&id="+encodeURIComponent(this.options.id)+"&identifier="+encodeURIComponent(this.options.identifier)+"&title="+encodeURIComponent(this.options.name)+"&url="+encodeURIComponent(this.options.url)+"&tags="+encodeURIComponent(this.options.tags)+"&host="+document.location.host+"&page="+document.location.href+"&screens="+encodeURIComponent(this.options.screens)+"&css="+encodeURIComponent(this.options.css)+"&captions="+encodeURIComponent(this.options.captions)+"&exclusions="+encodeURIComponent(this.options.exclusions)+"&inclusions="+encodeURIComponent(this.options.inclusions)+"&dialog_title="+encodeURIComponent(this.options.dialogTitle)+"&popup="+encodeURIComponent(this.options.popup)+"&picker_version="+encodeURIComponent(this.options.picker_version),this.options.imagesUrl=this.options.apiServer+"/widget/data"+"?app_id="+encodeURIComponent(this.options.app)+"&id="+encodeURIComponent(this.options.id)+"&identifier="+encodeURIComponent(this.options.identifier)+"&origin="+escape(document.location.host)},resetIframe:function(){this.$element.find(".chute-popup iframe").attr("src","//s3.amazonaws.com/cdn.getchute.com/html/v1/loading.html")},uploadComplete:function(a){a.moderated&&!this.options.popup&&this.$element.find(".chute-thanks").chuteReveal(),this.options.onSelectionComplete(this.$element,a),typeof chuteSelectionComplete=="function"&&chuteSelectionComplete(this.$element,a)},assetsRendered:function(a,b){var c=jQuery("#chute-thumbnail-reveal");c.length==0&&(jQuery("body").append('<div class="chute-thumbnail-reveal-modal" id="chute-thumbnail-reveal"><img src=""><a class="chute-thumbnail-source" href="" target="_blank">source</a><a class="close-chute-thumbnail-reveal-modal">&#215;</a></div>'),c=jQuery("#chute-thumbnail-reveal")),a.find(".chute-thumbnails a").live("click",function(a){a.preventDefault(),c.find("img").attr("src",$(this).attr("data-url")),c.find(".chute-thumbnail-source").attr("href",$(this).attr("data-source-url")),c.chuteReveal({dismissmodalclass:"close-chute-thumbnail-reveal-modal",top:"50px"})})},displayRender:function(a,b){var c=typeof this.options.display_template=="string"?this.options.display_template:this.options.display_template.template,d=typeof this.options.display_template=="string"?null:this.options.display_template.templateContainer;for(var e in this.options.template_options)this.options.display_template.options[e]&&(this.options.display_template.options[e].value=this.options.template_options[e]);typeof this.options.display_template.options!="undefined"&&(this.options.display_template.options.share_text=this.options.share_text,this.options.display_template.options.awesm_key=this.options.awesm_key,this.options.display_template.options.chute_id=this.options.chute_id,this.options.display_template.options.widget_id=this.options.widget_id);for(var f in a.data.assets)a.data.assets[f].serialized=encodeURIComponent($.serializeJSON(a.data.assets[f]).replace(/(\r\n|\n|\r|\t)/gm,""));var g=ChuteMustache.to_html(c,{images:a.data.assets,options:this.options.display_template.options});d&&(g=d.replace("{{yield}}",g));var h=!1;this.options.display_template.systemOptions&&this.options.display_template.systemOptions.appendContent&&(h=!0),b>-1?(d?b==0?this.options.templateContainer.prepend(g):h?this.options.templateContainer.append(g):this.options.templateContainer.html(g):b==0?this.$element.prepend(g):h?this.$element.append(g):this.$element.html(g),this.options.onAssetsReRendered(this.$element,a,this.options.display_template.options,b)):(this.options.templateContainer=this.$element.html(g),typeof this.options.onAssetsRendered=="function"&&this.options.onAssetsRendered(this.$element,a,this.options.display_template.options))}},methods={init:function(a){return a==undefined&&(a={}),this.each(function(){var b=$.extend({},CHUTE);b.init(this,a),b.$element.data("callback",function(){b.options.popup||b.$element.find(".close-chute-reveal-modal").click()}),a!=undefined&&typeof a.success=="function"&&b.$element.data("success-callback",a.success)})},chooser:function(a){var b=$(this);return a!=undefined&&b.data("success-callback",a),b.find(".chute-browseButton").click(),b},close:function(){var a=$(this);return a.find(".close-chute-reveal-modal").click(),a},success:function(a){var b=$(this);return typeof b.data("callback")=="function"&&b.data("callback")(),typeof b.data("success-callback")=="function"&&b.data("success-callback")(a),b},widget:function(){return $(this).find(".chute-popup iframe")}};$.fn.chute=function(a,b){if(a==undefined||typeof a=="object")return methods.init.apply(this,arguments);if(methods[a])return methods[a].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+a+" does not exist on jQuery.chute")}})(jQuery),function(a){function c(a){e(a.data)}function d(b){return typeof JSON!="undefined"?JSON.parse(b):a.parseJSON(b)}function e(a){try{a=d(a)}catch(b){a=a}currentWidget&&a.moderated!=undefined&&(currentWidget.$element.chute("success",a),currentWidget.uploadComplete(a))}if($chuteWidget!=undefined){a(".chute-widget:not(.chute-loaded)").chute();return}$chuteWidget="chute";if(a.browser.msie&&parseInt(a.browser.version)<=7){var b=document.location.hash;setInterval(function(){var a=document.location.hash;a!==b&&(b=a,e(decodeURIComponent(a).replace(/^#/,"")))},1e3)}else document.addEventListener?window.addEventListener("message",c,!1):window.attachEvent("onmessage",c);chuteImageLoaded=function(b){a(b).chuteScaleImage({fade:Math.floor(Math.random()*1e3)})}}(jQuery),ChuteMustache=function(){var a={},b=function(){};return b.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(a,b,c,d){d||(this.context=b,this.buffer=[]);if(!this.includes("",a)){if(d)return a;this.send(a);return}a=this.render_pragmas(a);var e=this.render_section(a,b,c);e===!1&&(e=this.render_tags(a,b,c,d));if(d)return e;this.sendLines(e)},send:function(a){a!==""&&this.buffer.push(a)},sendLines:function(a){if(a){var b=a.split("\n");for(var c=0;c<b.length;c++)this.send(b[c])}},render_pragmas:function(a){if(!this.includes("%",a))return a;var b=this,c=this.getCachedRegex("render_pragmas",function(a,b){return new RegExp(a+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+b,"g")});return a.replace(c,function(a,c,d){if(!b.pragmas_implemented[c])throw{message:"This implementation of mustache doesn't understand the '"+c+"' pragma"};b.pragmas[c]={};if(d){var e=d.split("=");b.pragmas[c][e[0]]=e[1]}return""})},render_partial:function(a,b,c){a=this.trim(a);if(!c||c[a]===undefined)throw{message:"unknown_partial '"+a+"'"};return typeof b[a]!="object"?this.render(c[a],b,c,!0):this.render(c[a],b[a],c,!0)},render_section:function(a,b,c){if(!this.includes("#",a)&&!this.includes("^",a))return!1;var d=this,e=this.getCachedRegex("render_section",function(a,b){return new RegExp("^([\\s\\S]*?)"+a+"(\\^|\\#)\\s*(.+)\\s*"+b+"\n*([\\s\\S]*?)"+a+"\\/\\s*\\3\\s*"+b+"\\s*([\\s\\S]*)$","g")});return a.replace(e,function(a,e,f,g,h,i){var j=e?d.render_tags(e,b,c,!0):"",k=i?d.render(i,b,c,!0):"",l,m=d.find(g,b);return f==="^"?!m||d.is_array(m)&&m.length===0?l=d.render(h,b,c,!0):l="":f==="#"&&(d.is_array(m)?l=d.map(m,function(a){return d.render(h,d.create_context(a),c,!0)}).join(""):d.is_object(m)?l=d.render(h,d.create_context(m),c,!0):typeof m=="function"?l=m.call(b,h,function(a){return d.render(a,b,c,!0)}):m?l=d.render(h,b,c,!0):l=""),j+l+k})},render_tags:function(a,b,c,d){var e=this,f=function(){return e.getCachedRegex("render_tags",function(a,b){return new RegExp(a+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+b+"+","g")})},g=f(),h=function(a,d,h){switch(d){case"!":return"";case"=":return e.set_delimiters(h),g=f(),"";case">":return e.render_partial(h,b,c);case"{":return e.find(h,b);default:return e.escape(e.find(h,b))}},i=a.split("\n");for(var j=0;j<i.length;j++)i[j]=i[j].replace(g,h,this),d||this.send(i[j]);if(d)return i.join("\n")},set_delimiters:function(a){var b=a.split(" ");this.otag=this.escape_regex(b[0]),this.ctag=this.escape_regex(b[1])},escape_regex:function(a){if(!arguments.callee.sRE){var b=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];arguments.callee.sRE=new RegExp("(\\"+b.join("|\\")+")","g")}return a.replace(arguments.callee.sRE,"\\$1")},find:function(a,b){function c(a){return a===!1||a===0||a}a=this.trim(a);var d;if(a.match(/([a-z_]+)\./ig)){var e=this.walk_context(a,b);c(e)&&(d=e)}else c(b[a])?d=b[a]:c(this.context[a])&&(d=this.context[a]);return typeof d=="function"?d.apply(b):d!==undefined?d:""},walk_context:function(a,b){var c=a.split("."),d=b[c[0]]!=undefined?b:this.context,e=d[c.shift()];while(e!=undefined&&c.length>0)d=e,e=e[c.shift()];return typeof e=="function"?e.apply(d):e},includes:function(a,b){return b.indexOf(this.otag+a)!=-1},escape:function(a){return a=String(a===null?"":a),a.replace(/&(?!\w+;)|["'<>\\]/g,function(a){switch(a){case"&":return"&amp;";case'"':return"&quot;";case"'":return"&#39;";case"<":return"&lt;";case">":return"&gt;";default:return a}})},create_context:function(a){if(this.is_object(a))return a;var b=".";this.pragmas["IMPLICIT-ITERATOR"]&&(b=this.pragmas["IMPLICIT-ITERATOR"].iterator);var c={};return c[b]=a,c},is_object:function(a){return a&&typeof a=="object"},is_array:function(a){return Object.prototype.toString.call(a)==="[object Array]"},trim:function(a){return a.replace(/^\s*|\s*$/g,"")},map:function(a,b){if(typeof a.map=="function")return a.map(b);var c=[],d=a.length;for(var e=0;e<d;e++)c.push(b(a[e]));return c},getCachedRegex:function(b,c){var d=a[this.otag];d||(d=a[this.otag]={});var e=d[this.ctag];e||(e=d[this.ctag]={});var f=e[b];return f||(f=e[b]=c(this.otag,this.ctag)),f}},{name:"mustache.js",version:"0.4.0-dev",to_html:function(a,c,d,e){var f=new b;e&&(f.send=e),f.render(a,c||{},d);if(!e)return f.buffer.join("\n")}}}(),function(a){a.fn.chuteScaleImage=function(b){function d(a,b){var d=e(a),g=d.width,h=d.height,i=b.width(),j=b.height(),k=parseInt(a.css("borderLeftWidth"),10)+parseInt(a.css("borderRightWidth"),10),l=parseInt(a.css("borderTopWidth"),10)+parseInt(a.css("borderBottomWidth"),10),m,n,o,p,q;if(j===0||i===0){var r=f(b);i=r.width,j=r.height}k=isNaN(k)?0:k,l=isNaN(l)?0:l,m=i/g,n=j/h,c.scale==="fit"?o=m<n?m:n:c.scale==="fill"&&(o=m>n?m:n),p=parseInt(g*o,10)-k,q=parseInt(h*o,10)-l,a.css({width:p,height:q}).attr({width:p,height:q}),c.center&&(a.css("margin-left",Math.floor((i-p)/2)),a.css("margin-top",Math.floor((j-q)/2))),c.fade>0?b.animate({opacity:1},c.fade):b.css("opacity",1)}function e(a){var b=new Image;return b.src=a.attr("src"),{width:b.width,height:b.height}}function f(b){var c=b.clone().css({visibility:"hidden",display:"block",position:"absolute"});c.find("img").attr("onload",""),a("body").append(c);var d={width:c.width(),height:c.height()};return c.remove(),d}var c=a.extend({parent:!1,scale:"fill",center:!0,fade:0},b);return this.each(function(){var b=a(this),e=c.parent?b.parents(c.parent):b.parent();e.css({opacity:0,overflow:"hidden"}),e.length>0&&(b.removeAttr("height").removeAttr("width"),this.complete?d(b,e):b.load(function(){d(b,e)}))})}}(jQuery),jQuery.fn.hasChuteScrollBarH=function(){var a=jQuery(this);return a.get(0).scrollHeight-a.innerHeight()>2},jQuery.fn.onScrollToBottom=function(a){var b=jQuery(this),c=b.parent().hasChuteScrollBarH()&&!b.parent().is("body")?b.parent():jQuery(window);c.scroll(function(){var b=typeof c.get(0).scrollHeight=="undefined"?jQuery(document).height():c.get(0).scrollHeight;b-(c.scrollTop()+c.height())<100&&a()})},function(a){a("a[data-chute-reveal-id]").live("click",function(b){b.preventDefault();var c=a(this).attr("data-reveal-id");a("#"+c).reveal(a(this).data())}),a.fn.chuteReveal=function(b){var c={animation:"fadeAndPop",animationspeed:300,closeonbackgroundclick:!1,dismissmodalclass:"close-chute-reveal-modal",top:"100px",backgroundOpacity:.5},b=a.extend({},c,b);return this.each(function(){function i(){f=!1}function j(){f=!0}var c=a(this),d=parseInt(c.css("top")),e=c.height()+d,f=!1,g=a(".chute-reveal-modal-bg");g.length==0&&(g=a('<div class="chute-reveal-modal-bg" />').insertAfter(c)),c.bind("reveal:open",function(){g.unbind("click.modalEvent"),a("."+b.dismissmodalclass).unbind("click.modalEvent"),f||(j(),b.animation=="fadeAndPop"&&(c.css({top:-c.height(),opacity:1,visibility:"visible"}),g.css({opacity:0,display:"block"}),g.animate({opacity:b.backgroundOpacity},b.animationspeed/2),setTimeout(function(){c.animate({top:b.top,opacity:1},b.animationspeed,i())},b.animationspeed/2)),b.animation=="fade"&&(c.css({opacity:0,visibility:"visible",top:a(document).scrollTop()+d}),g.fadeIn(b.animationspeed/2),setTimeout(function(){c.animate({opacity:1},b.animationspeed,i())},b.animationspeed/2)),b.animation=="none"&&(c.css({visibility:"visible",top:a(document).scrollTop()+d}),g.css({display:"block"}),i())),c.unbind("reveal:open")}),c.bind("reveal:close",function(){f||(j(),b.animation=="fadeAndPop"&&(g.animate({opacity:0},b.animationspeed),setTimeout(function(){g.css({display:"none"})},b.animationspeed),c.animate({top:a(document).scrollTop()-e+"px",opacity:0},b.animationspeed/2,function(){c.css({top:d,opacity:1,visibility:"hidden"}),i()})),b.animation=="fade"&&(setTimeout(function(){g.fadeOut(b.animationspeed)},b.animationspeed),c.animate({opacity:0},b.animationspeed,function(){c.css({opacity:1,visibility:"hidden",top:d}),i()})),b.animation=="none"&&(c.css({visibility:"hidden",top:d}),g.css({display:"none"}))),c.unbind("reveal:close")}),c.trigger("reveal:open");var h=a("."+b.dismissmodalclass).bind("click.modalEvent",function(){c.trigger("reveal:close")});b.closeonbackgroundclick&&(g.css({cursor:"pointer"}),g.bind("click.modalEvent",function(){c.trigger("reveal:close")})),a("body").keyup(function(a){a.which===27&&c.trigger("reveal:close")})})},a.extend({serializeJSON:function(b){var c=typeof b;if(c!="object"||b===null)return c=="string"&&(b='"'+b+'"'),String(b);var d=[],e=b&&b.constructor==Array;return a.each(b,function(b,f){c=typeof f,c=="string"?f='"'+f+'"':c=="object"&f!==null&&(f=a.serializeJSON(f)),d.push((e?"":'"'+b+'":')+String(f))}),(e?"[":"{")+String(d)+(e?"]":"}")}})}(jQuery),function(){function k(){this.returnValue=!1}function l(){this.cancelBubble=!0}var a=0,b=[],c={},d={},e={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},f=/[<>&\"\']/g,g,h=window.setTimeout,i={},j;(function(a){var b=a.split(/,/),c,e,f;for(c=0;c<b.length;c+=2){f=b[c+1].split(/ /);for(e=0;e<f.length;e++)d[f[e]]=b[c]}})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var m={VERSION:"1.5.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:d,ua:function(){var a=navigator,b=a.userAgent,c=a.vendor,d,e,f;return d=/WebKit/.test(b),f=d&&c.indexOf("Apple")!==-1,e=window.opera&&window.opera.buildNumber,{windows:navigator.platform.indexOf("Win")!==-1,ie:!d&&!e&&/MSIE/gi.test(b)&&/Explorer/gi.test(a.appName),webkit:d,gecko:!d&&/Gecko/.test(b),safari:f,opera:!!e}}(),typeOf:function(a){return{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(a){return m.each(arguments,function(b,c){c>0&&m.each(b,function(b,c){a[c]=b})}),a},cleanName:function(a){var b,c;c=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(b=0;b<c.length;b+=2)a=a.replace(c[b],c[b+1]);return a=a.replace(/\s+/g,"_"),a=a.replace(/[^a-z0-9_\-\.]+/gi,""),a},addRuntime:function(a,c){return c.name=a,b[a]=c,b.push(c),c},guid:function(){var b=(new Date).getTime().toString(32),c;for(c=0;c<5;c++)b+=Math.floor(Math.random()*65535).toString(32);return(m.guidPrefix||"p")+b+(a++).toString(32)},buildUrl:function(a,b){var c="";return m.each(b,function(a,b){c+=(c?"&":"")+encodeURIComponent(b)+"="+encodeURIComponent(a)}),c&&(a+=(a.indexOf("?")>0?"&":"?")+c),a},each:function(a,b){var c,d,e;if(a){c=a.length;if(c===g){for(d in a)if(a.hasOwnProperty(d)&&b(a[d],d)===!1)return}else for(e=0;e<c;e++)if(b(a[e],e)===!1)return}},formatSize:function(a){return a===g||/\D/.test(a)?m.translate("N/A"):a>1073741824?Math.round(a/1073741824,1)+" GB":a>1048576?Math.round(a/1048576,1)+" MB":a>1024?Math.round(a/1024,1)+" KB":a+" b"},getPos:function(a,b){function i(a){var b,c,d=0,e=0;return a&&(c=a.getBoundingClientRect(),b=f.compatMode==="CSS1Compat"?f.documentElement:f.body,d=c.left+b.scrollLeft,e=c.top+b.scrollTop),{x:d,y:e}}var c=0,d=0,e,f=document,g,h;a=a,b=b||f.body;if(a&&a.getBoundingClientRect&&navigator.userAgent.indexOf("MSIE")>0&&f.documentMode!==8)return g=i(a),h=i(b),{x:g.x-h.x,y:g.y-h.y};e=a;while(e&&e!=b&&e.nodeType)c+=e.offsetLeft||0,d+=e.offsetTop||0,e=e.offsetParent;e=a.parentNode;while(e&&e!=b&&e.nodeType)c-=e.scrollLeft||0,d-=e.scrollTop||0,e=e.parentNode;return{x:c,y:d}},getSize:function(a){return{w:a.offsetWidth||a.clientWidth,h:a.offsetHeight||a.clientHeight}},parseSize:function(a){var b;return typeof a=="string"&&(a=/^([0-9]+)([mgk]?)$/.exec(a.toLowerCase().replace(/[^0-9mkg]/g,"")),b=a[2],a=+a[1],b=="g"&&(a*=1073741824),b=="m"&&(a*=1048576),b=="k"&&(a*=1024)),a},xmlEncode:function(a){return a?(""+a).replace(f,function(a){return e[a]?"&"+e[a]+";":a}):a},toArray:function(a){var b,c=[];for(b=0;b<a.length;b++)c[b]=a[b];return c},inArray:function(a,b){if(b){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c}return-1},addI18n:function(a){return m.extend(c,a)},translate:function(a){return c[a]||a},isEmptyObj:function(a){if(a===g)return!0;for(var b in a)return!1;return!0},hasClass:function(a,b){var c;return a.className==""?!1:(c=new RegExp("(^|\\s+)"+b+"(\\s+|$)"),c.test(a.className))},addClass:function(a,b){m.hasClass(a,b)||(a.className=a.className==""?b:a.className.replace(/\s+$/,"")+" "+b)},removeClass:function(a,b){var c=new RegExp("(^|\\s+)"+b+"(\\s+|$)");a.className=a.className.replace(c,function(a,b,c){return b===" "&&c===" "?" ":""})},getStyle:function(a,b){if(a.currentStyle)return a.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(a,null)[b]},addEvent:function(a,b,c){var d,e,f,h;h=arguments[3],b=b.toLowerCase(),j===g&&(j="Plupload_"+m.guid()),a.addEventListener?(d=c,a.addEventListener(b,d,!1)):a.attachEvent&&(d=function(){var a=window.event;a.target||(a.target=a.srcElement),a.preventDefault=k,a.stopPropagation=l,c(a)},a.attachEvent("on"+b,d)),a[j]===g&&(a[j]=m.guid()),i.hasOwnProperty(a[j])||(i[a[j]]={}),e=i[a[j]],e.hasOwnProperty(b)||(e[b]=[]),e[b].push({func:d,orig:c,key:h})},removeEvent:function(a,b){var c,d,e;typeof arguments[2]=="function"?d=arguments[2]:e=arguments[2],b=b.toLowerCase();if(a[j]&&i[a[j]]&&i[a[j]][b])c=i[a[j]][b];else return;for(var f=c.length-1;f>=0;f--)if(c[f].key===e||c[f].orig===d){a.detachEvent?a.detachEvent("on"+b,c[f].func):a.removeEventListener&&a.removeEventListener(b,c[f].func,!1),c[f].orig=null,c[f].func=null,c.splice(f,1);if(d!==g)break}c.length||delete i[a[j]][b];if(m.isEmptyObj(i[a[j]])){delete i[a[j]];try{delete a[j]}catch(h){a[j]=g}}},removeAllEvents:function(a){var b=arguments[1];if(a[j]===g||!a[j])return;m.each(i[a[j]],function(c,d){m.removeEvent(a,d,b)})}};m.Uploader=function(a){function j(){var a,b=0,c;if(this.state==m.STARTED){for(c=0;c<e.length;c++)!a&&e[c].status==m.QUEUED?(a=e[c],a.status=m.UPLOADING,this.trigger("BeforeUpload",a)&&this.trigger("UploadFile",a)):b++;b==e.length&&(this.stop(),this.trigger("UploadComplete",e))}}function k(){var a,b;d.reset();for(a=0;a<e.length;a++)b=e[a],b.size!==g?(d.size+=b.size,d.loaded+=b.loaded):d.size=g,b.status==m.DONE?d.uploaded++:b.status==m.FAILED?d.failed++:d.queued++;d.size===g?d.percent=e.length>0?Math.ceil(d.uploaded/e.length*100):0:(d.bytesPerSec=Math.ceil(d.loaded/((+(new Date)-f||1)/1e3)),d.percent=d.size>0?Math.ceil(d.loaded/d.size*100):0)}var c={},d,e=[],f,i=!1;d=new m.QueueProgress,a=m.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},a),m.extend(this,{state:m.STOPPED,runtime:"",features:{},files:e,settings:a,total:d,id:m.guid(),init:function(){function q(){var a=i[n++],b,d,e;if(a){b=a.getFeatures(),d=c.settings.required_features;if(d){d=d.split(",");for(e=0;e<d.length;e++)if(!b[d[e]]){q();return}}a.init(c,function(d){d&&d.success?(c.features=b,c.runtime=a.name,c.trigger("Init",{runtime:a.name}),c.trigger("PostInit"),c.refresh()):q()})}else c.trigger("Error",{code:m.INIT_ERROR,message:m.translate("Init error.")})}var c=this,d,i,l,n=0,p;typeof a.preinit=="function"?a.preinit(c):m.each(a.preinit,function(a,b){c.bind(b,a)}),a.page_url=a.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(a.url)||(a.url=a.page_url+a.url),a.chunk_size=m.parseSize(a.chunk_size),a.max_file_size=m.parseSize(a.max_file_size),c.bind("FilesAdded",function(b,d){var f,i,j=0,k,l=a.filters;l&&l.length&&(k=[],m.each(l,function(a){m.each(a.extensions.split(/,/),function(a){/^\s*\*\s*$/.test(a)?k.push("\\.*"):k.push("\\."+a.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),k=new RegExp(k.join("|")+"$","i"));for(f=0;f<d.length;f++){i=d[f],i.loaded=0,i.percent=0,i.status=m.QUEUED;if(k&&!k.test(i.name)){b.trigger("Error",{code:m.FILE_EXTENSION_ERROR,message:m.translate("File extension error."),file:i});continue}if(i.size!==g&&i.size>a.max_file_size){b.trigger("Error",{code:m.FILE_SIZE_ERROR,message:m.translate("File size error."),file:i});continue}e.push(i),j++}if(j)h(function(){c.trigger("QueueChanged"),c.refresh()},1);else return!1}),a.unique_names&&c.bind("UploadFile",function(a,b){var c=b.name.match(/\.([^.]+)$/),d="tmp";c&&(d=c[1]),b.target_name=b.id+"."+d}),c.bind("UploadProgress",function(a,b){b.percent=b.size>0?Math.ceil(b.loaded/b.size*100):100,k()}),c.bind("StateChanged",function(a){if(a.state==m.STARTED)f=+(new Date);else if(a.state==m.STOPPED)for(d=a.files.length-1;d>=0;d--)a.files[d].status==m.UPLOADING&&(a.files[d].status=m.QUEUED,k())}),c.bind("QueueChanged",k),c.bind("Error",function(a,b){b.file&&(b.file.status=m.FAILED,k(),a.state==m.STARTED&&h(function(){j.call(c)},1))}),c.bind("FileUploaded",function(a,b){b.status=m.DONE,b.loaded=b.size,a.trigger("UploadProgress",b),h(function(){j.call(c)},1)});if(a.runtimes){i=[],p=a.runtimes.split(/\s?,\s?/);for(d=0;d<p.length;d++)b[p[d]]&&i.push(b[p[d]])}else i=b;q(),typeof a.init=="function"?a.init(c):m.each(a.init,function(a,b){c.bind(b,a)})},refresh:function(){this.trigger("Refresh")},start:function(){this.state!=m.STARTED&&(this.state=m.STARTED,this.trigger("StateChanged"),j.call(this))},stop:function(){this.state!=m.STOPPED&&(this.state=m.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){i=arguments[0]!==g?arguments[0]:!0,this.trigger("DisableBrowse",i)},getFile:function(a){var b;for(b=e.length-1;b>=0;b--)if(e[b].id===a)return e[b]},removeFile:function(a){var b;for(b=e.length-1;b>=0;b--)if(e[b].id===a.id)return this.splice(b,1)[0]},splice:function(a,b){var c;return c=e.splice(a===g?0:a,b===g?e.length:b),this.trigger("FilesRemoved",c),this.trigger("QueueChanged"),c},trigger:function(a){var b=c[a.toLowerCase()],d,e;if(b){e=Array.prototype.slice.call(arguments),e[0]=this;for(d=0;d<b.length;d++)if(b[d].func.apply(b[d].scope,e)===!1)return!1}return!0},hasEventListener:function(a){return!!c[a.toLowerCase()]},bind:function(a,b,d){var e;a=a.toLowerCase(),e=c[a]||[],e.push({func:b,scope:d||this}),c[a]=e},unbind:function(a){a=a.toLowerCase();var b=c[a],d,e=arguments[1];if(b){if(e!==g){for(d=b.length-1;d>=0;d--)if(b[d].func===e){b.splice(d,1);break}}else b=[];b.length||delete c[a]}},unbindAll:function(){var a=this;m.each(c,function(b,c){a.unbind(c)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},m.File=function(a,b,c){var d=this;d.id=a,d.name=b,d.size=c,d.loaded=0,d.percent=0,d.status=0},m.Runtime=function(){this.getFeatures=function(){},this.init=function(a,b){}},m.QueueProgress=function(){var a=this;a.size=0,a.loaded=0,a.uploaded=0,a.failed=0,a.queued=0,a.percent=0,a.bytesPerSec=0,a.reset=function(){a.size=a.loaded=a.uploaded=a.failed=a.queued=a.percent=a.bytesPerSec=0}},m.runtimes={},window.plupload=m}(),function(){if(window.google&&google.gears)return;var a=null;if(typeof GearsFactory!="undefined")a=new GearsFactory;else try{a=new ActiveXObject("Gears.Factory"),a.getBuildInfo().indexOf("ie_mobile")!=-1&&a.privateSetGlobalObject(this)}catch(b){typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-googlegears"]&&(a=document.createElement("object"),a.style.display="none",a.width=0,a.height=0,a.type="application/x-googlegears",document.documentElement.appendChild(a))}if(!a)return;window.google||(window.google={}),google.gears||(google.gears={factory:a})}(),function(a,b,c,d){function f(a,b,c){var d,e,f,g;e=google.gears.factory.create("beta.canvas");try{e.decode(a),b.width||(b.width=e.width),b.height||(b.height=e.height),g=Math.min(width/e.width,height/e.height);if(g<1||g===1&&c==="image/jpeg")return e.resize(Math.round(e.width*g),Math.round(e.height*g)),b.quality?e.encode(c,{quality:b.quality/100}):e.encode(c)}catch(h){}return a}var e={};c.runtimes.Gears=c.addRuntime("gears",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(d,g){function l(a){var b,f,g=[],h;for(f=0;f<a.length;f++)b=a[f],h=c.guid(),e[h]=b.blob,g.push(new c.File(h,b.name,b.blob.length));d.trigger("FilesAdded",g)}var h,i,j=!1;if(!a.google||!google.gears)return g({success:!1});try{h=google.gears.factory.create("beta.desktop")}catch(k){return g({success:!1})}d.bind("PostInit",function(){var a=d.settings,e=b.getElementById(a.drop_element);e&&(c.addEvent(e,"dragover",function(a){h.setDropEffect(a,"copy"),a.preventDefault()},d.id),c.addEvent(e,"drop",function(a){var b=h.getDragData(a,"application/x-gears-files");b&&l(b.files),a.preventDefault()},d.id),e=0),c.addEvent(b.getElementById(a.browse_button),"click",function(b){var c=[],d,e,f;b.preventDefault();if(j)return;g:for(d=0;d<a.filters.length;d++){f=a.filters[d].extensions.split(",");for(e=0;e<f.length;e++){if(f[e]==="*"){c=[];break g}c.push("."+f[e])}}h.openFiles(l,{singleFile:!a.multi_selection,filter:c})},d.id)}),d.bind("CancelUpload",function(){i.abort&&i.abort()}),d.bind("UploadFile",function(a,b){function m(){function y(d){var e,f="----pluploadboundary"+c.guid(),g="--",h="\r\n",j,l;k&&(i.setRequestHeader("Content-Type","multipart/form-data; boundary="+f),e=google.gears.factory.create("beta.blobbuilder"),c.each(c.extend(q,a.settings.multipart_params),function(a,b){e.append(g+f+h+'Content-Disposition: form-data; name="'+b+'"'+h+h),e.append(a+h)}),l=c.mimeTypes[b.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",e.append(g+f+h+'Content-Disposition: form-data; name="'+a.settings.file_data_name+'"; filename="'+b.name+'"'+h+"Content-Type: "+l+h+h),e.append(d),e.append(h+g+f+g+h),j=e.getAsBlob(),n=j.length-d.length,d=j),i.send(d)}var f,k=a.settings.multipart,n=0,q={name:b.target_name||b.name},x=a.settings.url;if(b.status==c.DONE||b.status==c.FAILED||a.state==c.STOPPED)return;l&&(q.chunk=d,q.chunks=g),f=Math.min(h,b.size-d*h),k||(x=c.buildUrl(a.settings.url,q)),i=google.gears.factory.create("beta.httprequest"),i.open("POST",x),k||(i.setRequestHeader("Content-Disposition",'attachment; filename="'+b.name+'"'),i.setRequestHeader("Content-Type","application/octet-stream")),c.each(a.settings.headers,function(a,b){i.setRequestHeader(b,a)}),i.upload.onprogress=function(c){b.loaded=j+c.loaded-n,a.trigger("UploadProgress",b)},i.onreadystatechange=function(){var e;if(i.readyState==4&&a.state!==c.STOPPED)if(i.status==200){e={chunk:d,chunks:g,response:i.responseText,status:i.status},a.trigger("ChunkUploaded",b,e);if(e.cancelled){b.status=c.FAILED;return}j+=f,++d>=g?(b.status=c.DONE,a.trigger("FileUploaded",b,{response:i.responseText,status:i.status})):m()}else a.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:b,chunk:d,chunks:g,status:i.status})},d<g&&y(e[b.id].slice(d*h,f))}var d=0,g,h,j=0,k=a.settings.resize,l;k&&/\.(png|jpg|jpeg)$/i.test(b.name)&&(e[b.id]=f(e[b.id],k,/\.png$/i.test(b.name)?"image/png":"image/jpeg")),b.size=e[b.id].length,h=a.settings.chunk_size,l=h>0,g=Math.ceil(b.size/h),l||(h=b.size,g=1),m()}),d.bind("DisableBrowse",function(a,b){j=b}),d.bind("Destroy",function(a){var d,e,f={browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(d in f)e=b.getElementById(f[d]),e&&c.removeAllEvents(e,a.id)}),g({success:!0})}})}(window,document,plupload),function(a,b,c,d){function g(a){var b,c=typeof a,e,f,h;if(a===d||a===null)return"null";if(c==="string")return b="\bb\tt\nn\ff\rr\"\"''\\\\",'"'+a.replace(/([\u0080-\uFFFF\x00-\x1f\"])/g,function(a,c){var d=b.indexOf(c);return d+1?"\\"+b.charAt(d+1):(a=c.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a)})+'"';if(c=="object"){e=a.length!==d,b="";if(e){for(f=0;f<a.length;f++)b&&(b+=","),b+=g(a[f]);b="["+b+"]"}else{for(h in a)a.hasOwnProperty(h)&&(b&&(b+=","),b+=g(h)+":"+g(a[h]));b="{"+b+"}"}return b}return""+a}function h(a){var b=!1,c=null,d=null,e,f,g,h,i,j=0;try{try{d=new ActiveXObject("AgControl.AgControl"),d.IsVersionSupported(a)&&(b=!0),d=null}catch(k){var l=navigator.plugins["Silverlight Plug-In"];if(l){e=l.description,e==="1.0.30226.2"&&(e="2.0.30226.2"),f=e.split(".");while(f.length>3)f.pop();while(f.length<4)f.push(0);g=a.split(".");while(g.length>4)g.pop();do h=parseInt(g[j],10),i=parseInt(f[j],10),j++;while(j<g.length&&h===i);h<=i&&!isNaN(h)&&(b=!0)}}}catch(m){b=!1}return b}var e={},f={};c.silverlight={trigger:function(a,b){var d=e[a],f,g;d&&(g=c.toArray(arguments).slice(1),g[0]="Silverlight:"+b,setTimeout(function(){d.trigger.apply(d,g)},0))}},c.runtimes.Silverlight=c.addRuntime("silverlight",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(d,i){function o(){return b.getElementById(d.id+"_silverlight").content.Upload}var j,k="",l=d.settings.filters,m,n=b.body;if(!h("2.0.31005.0")||a.opera&&a.opera.buildNumber){i({success:!1});return}f[d.id]=!1,e[d.id]=d,j=b.createElement("div"),j.id=d.id+"_silverlight_container",c.extend(j.style,{position:"absolute",top:"0px",background:d.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100px",height:"100px",overflow:"hidden",opacity:d.settings.shim_bgcolor||b.documentMode>8?"":.01}),j.className="plupload silverlight",d.settings.container&&(n=b.getElementById(d.settings.container),c.getStyle(n,"position")==="static"&&(n.style.position="relative")),n.appendChild(j);for(m=0;m<l.length;m++)k+=(k!=""?"|":"")+l[m].title+" | *."+l[m].extensions.replace(/,/g,";*.");j.innerHTML='<object id="'+d.id+'_silverlight" data="data:application/x-silverlight," type="application/x-silverlight-2" style="outline:none;" width="1024" height="1024"><param name="source" value="'+d.settings.silverlight_xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="id='+d.id+",filter="+k+",multiselect="+d.settings.multi_selection+'"/></object>',d.bind("Silverlight:Init",function(){var a,h={};if(f[d.id])return;f[d.id]=!0,d.bind("Silverlight:StartSelectFiles",function(b){a=[]}),d.bind("Silverlight:SelectFile",function(b,d,e,f){var g;g=c.guid(),h[g]=d,h[d]=g,a.push(new c.File(g,e,f))}),d.bind("Silverlight:SelectSuccessful",function(){a.length&&d.trigger("FilesAdded",a)}),d.bind("Silverlight:UploadChunkError",function(a,b,e,f,g){d.trigger("Error",{code:c.IO_ERROR,message:"IO Error.",details:g,file:a.getFile(h[b])})}),d.bind("Silverlight:UploadFileProgress",function(a,b,d,e){var f=a.getFile(h[b]);f.status!=c.FAILED&&(f.size=e,f.loaded=d,a.trigger("UploadProgress",f))}),d.bind("Refresh",function(a){var d,e,f;d=b.getElementById(a.settings.browse_button),d&&(e=c.getPos(d,b.getElementById(a.settings.container)),f=c.getSize(d),c.extend(b.getElementById(a.id+"_silverlight_container").style,{top:e.y+"px",left:e.x+"px",width:f.w+"px",height:f.h+"px"}))}),d.bind("Silverlight:UploadChunkSuccessful",function(a,b,d,e,f){var g,i=a.getFile(h[b]);g={chunk:d,chunks:e,response:f},a.trigger("ChunkUploaded",i,g),i.status!=c.FAILED&&a.state!==c.STOPPED&&o().UploadNextChunk(),d==e-1&&(i.status=c.DONE,a.trigger("FileUploaded",i,{response:f}))}),d.bind("Silverlight:UploadSuccessful",function(a,b,d){var e=a.getFile(h[b]);e.status=c.DONE,a.trigger("FileUploaded",e,{response:d})}),d.bind("FilesRemoved",function(a,b){var c;for(c=0;c<b.length;c++)o().RemoveFile(h[b[c].id])}),d.bind("UploadFile",function(a,b){var d=a.settings,e=d.resize||{};o().UploadFile(h[b.id],a.settings.url,g({name:b.target_name||b.name,mime:c.mimeTypes[b.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:d.chunk_size,image_width:e.width,image_height:e.height,image_quality:e.quality||90,multipart:!!d.multipart,multipart_params:d.multipart_params||{},file_data_name:d.file_data_name,headers:d.headers}))}),d.bind("CancelUpload",function(){o().CancelUpload()}),d.bind("Silverlight:MouseEnter",function(a){var e,f;e=b.getElementById(d.settings.browse_button),f=a.settings.browse_button_hover,e&&f&&c.addClass(e,f)}),d.bind("Silverlight:MouseLeave",function(a){var e,f;e=b.getElementById(d.settings.browse_button),f=a.settings.browse_button_hover,e&&f&&c.removeClass(e,f)}),d.bind("Silverlight:MouseLeftButtonDown",function(a){var e,f;e=b.getElementById(d.settings.browse_button),f=a.settings.browse_button_active,e&&f&&(c.addClass(e,f),c.addEvent(b.body,"mouseup",function(){c.removeClass(e,f)}))}),d.bind("Sliverlight:StartSelectFiles",function(a){var e,f;e=b.getElementById(d.settings.browse_button),f=a.settings.browse_button_active,e&&f&&c.removeClass(e,f)}),d.bind("DisableBrowse",function(a,b){o().DisableBrowse(b)}),d.bind("Destroy",function(a){var d;c.removeAllEvents(b.body,a.id),delete f[a.id],delete e[a.id],d=b.getElementById(a.id+"_silverlight_container"),d&&n.removeChild(d)}),i({success:!0})})}})}(window,document,plupload),function(a,b,c,d){function g(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1])}var e={},f={};c.flash={trigger:function(a,b,c){setTimeout(function(){var d=e[a],f,g;d&&d.trigger("Flash:"+b,c)},0)}},c.runtimes.Flash=c.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(a,d){function l(){return b.getElementById(a.id+"_flash")}function m(){if(j++>5e3){d({success:!1});return}f[a.id]||setTimeout(m,1)}var h,i,j=0,k=b.body;if(g()<10){d({success:!1});return}f[a.id]=!1,e[a.id]=a,h=b.getElementById(a.settings.browse_button),i=b.createElement("div"),i.id=a.id+"_flash_container",c.extend(i.style,{position:"absolute",top:"0px",background:a.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),i.className="plupload flash",a.settings.container&&(k=b.getElementById(a.settings.container),c.getStyle(k,"position")==="static"&&(k.style.position="relative")),k.appendChild(i),function(){var d,e;d='<object id="'+a.id+'_flash" type="application/x-shockwave-flash" data="'+a.settings.flash_swf_url+'" ',c.ua.ie&&(d+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),d+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(a.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',c.ua.ie?(e=b.createElement("div"),i.appendChild(e),e.outerHTML=d,e=null):i.innerHTML=d}(),m(),h=i=null,a.bind("Flash:Init",function(){var g={},h;l().setFileFilters(a.settings.filters,a.settings.multi_selection);if(f[a.id])return;f[a.id]=!0,a.bind("UploadFile",function(b,d){var e=b.settings,f=a.settings.resize||{};l().uploadFile(g[d.id],e.url,{name:d.target_name||d.name,mime:c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:e.chunk_size,width:f.width,height:f.height,quality:f.quality,multipart:e.multipart,multipart_params:e.multipart_params||{},file_data_name:e.file_data_name,format:/\.(jpg|jpeg)$/i.test(d.name)?"jpg":"png",headers:e.headers,urlstream_upload:e.urlstream_upload})}),a.bind("CancelUpload",function(){l().cancelUpload()}),a.bind("Flash:UploadProcess",function(a,b){var d=a.getFile(g[b.id]);d.status!=c.FAILED&&(d.loaded=b.loaded,d.size=b.size,a.trigger("UploadProgress",d))}),a.bind("Flash:UploadChunkComplete",function(a,b){var d,e=a.getFile(g[b.id]);d={chunk:b.chunk,chunks:b.chunks,response:b.text},a.trigger("ChunkUploaded",e,d),e.status!==c.FAILED&&a.state!==c.STOPPED&&l().uploadNextChunk(),b.chunk==b.chunks-1&&(e.status=c.DONE,a.trigger("FileUploaded",e,{response:b.text}))}),a.bind("Flash:SelectFiles",function(b,d){var e,f,h=[],i;for(f=0;f<d.length;f++)e=d[f],i=c.guid(),g[i]=e.id,g[e.id]=i,h.push(new c.File(i,e.name,e.size));h.length&&a.trigger("FilesAdded",h)}),a.bind("Flash:SecurityError",function(b,d){a.trigger("Error",{code:c.SECURITY_ERROR,message:c.translate("Security error."),details:d.message,file:a.getFile(g[d.id])})}),a.bind("Flash:GenericError",function(b,d){a.trigger("Error",{code:c.GENERIC_ERROR,message:c.translate("Generic error."),details:d.message,file:a.getFile(g[d.id])})}),a.bind("Flash:IOError",function(b,d){a.trigger("Error",{code:c.IO_ERROR,message:c.translate("IO error."),details:d.message,file:a.getFile(g[d.id])})}),a.bind("Flash:ImageError",function(b,d){a.trigger("Error",{code:parseInt(d.code,10),message:c.translate("Image error."),file:a.getFile(g[d.id])})}),a.bind("Flash:StageEvent:rollOver",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_hover,e&&f&&c.addClass(e,f)}),a.bind("Flash:StageEvent:rollOut",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_hover,e&&f&&c.removeClass(e,f)}),a.bind("Flash:StageEvent:mouseDown",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_active,e&&f&&(c.addClass(e,f),c.addEvent(b.body,"mouseup",function(){c.removeClass(e,f)},d.id))}),a.bind("Flash:StageEvent:mouseUp",function(d){var e,f;e=b.getElementById(a.settings.browse_button),f=d.settings.browse_button_active,e&&f&&c.removeClass(e,f)}),a.bind("Flash:ExifData",function(b,c){a.trigger("ExifData",a.getFile(g[c.id]),c.data)}),a.bind("Flash:GpsData",function(b,c){a.trigger("GpsData",a.getFile(g[c.id]),c.data)}),a.bind("QueueChanged",function(b){a.refresh()}),a.bind("FilesRemoved",function(a,b){var c;for(c=0;c<b.length;c++)l().removeFile(g[b[c].id])}),a.bind("StateChanged",function(b){a.refresh()}),a.bind("Refresh",function(d){var e,f,g;l().setFileFilters(a.settings.filters,a.settings.multi_selection),e=b.getElementById(d.settings.browse_button),e&&(f=c.getPos(e,b.getElementById(d.settings.container)),g=c.getSize(e),c.extend(b.getElementById(d.id+"_flash_container").style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"}))}),a.bind("DisableBrowse",function(a,b){l().disableBrowse(b)}),a.bind("Destroy",function(a){var d;c.removeAllEvents(b.body,a.id),delete f[a.id],delete e[a.id],d=b.getElementById(a.id+"_flash_container"),d&&k.removeChild(d)}),d({success:!0})})}})}(window,document,plupload),function(a){a.runtimes.BrowserPlus=a.addRuntime("browserplus",{getFeatures:function(){return{dragdrop:!0,jpgresize:!0,pngresize:!0,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(b,c){function h(c){var d,f,g=[],h,i;for(f=0;f<c.length;f++)h=c[f],i=a.guid(),e[i]=h,g.push(new a.File(i,h.name,h.size));f&&b.trigger("FilesAdded",g)}function i(){var i=!1;b.bind("PostInit",function(){function m(a,b){d.DragAndDrop.AddDropTarget({id:a},function(c){d.DragAndDrop.AttachCallbacks({id:a,hover:function(a){!a&&b&&b()},drop:function(a){b&&b(),h(a)}},function(){})})}function n(){document.getElementById(g).style.top="-1000px"}var c,e=f.drop_element,g=b.id+"_droptarget",j=document.getElementById(e),l;j&&(document.attachEvent&&/MSIE/gi.test(navigator.userAgent)?(c=document.createElement("div"),c.setAttribute("id",g),a.extend(c.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0}),document.body.appendChild(c),a.addEvent(j,"dragenter",function(b){var c,d;c=document.getElementById(e),d=a.getPos(c),a.extend(document.getElementById(g).style,{top:d.y+"px",left:d.x+"px",width:c.offsetWidth+"px",height:c.offsetHeight+"px"})}),m(g,n)):m(e)),a.addEvent(document.getElementById(f.browse_button),"click",function(b){var c=[],e,g,j=f.filters,l,m;b.preventDefault();if(i)return;n:for(e=0;e<j.length;e++){l=j[e].extensions.split(",");for(g=0;g<l.length;g++){if(l[g]==="*"){c=[];break n}m=a.mimeTypes[l[g]],m&&a.inArray(m,c)===-1&&c.push(a.mimes[l[g]])}}d.FileBrowse.OpenBrowseDialog({mimeTypes:c},function(a){a.success&&h(a.value)})}),j=c=null}),b.bind("CancelUpload",function(){d.Uploader.cancel()}),b.bind("DisableBrowse",function(a,b){i=b}),b.bind("UploadFile",function(b,c){function l(e,f){var g;if(c.status==a.FAILED)return;h.name=c.target_name||c.name,i&&(h.chunk=""+e,h.chunks=""+f),g=k.shift(),d.Uploader.upload({url:b.settings.url,files:{file:g},cookies:document.cookies,postvars:a.extend(h,b.settings.multipart_params),progressCallback:function(a){var d,f=0;j[e]=parseInt(a.filePercent*g.size/100,10);for(d=0;d<j.length;d++)f+=j[d];c.loaded=f,b.trigger("UploadProgress",c)}},function(d){var g,h;d.success?(g=d.value.statusCode,i&&b.trigger("ChunkUploaded",c,{chunk:e,chunks:f,response:d.value.body,status:g}),k.length>0?l(++e,f):(c.status=a.DONE,b.trigger("FileUploaded",c,{response:d.value.body,status:g}),g>=400&&b.trigger("Error",{code:a.HTTP_ERROR,message:a.translate("HTTP Error."),file:c,status:g}))):b.trigger("Error",{code:a.GENERIC_ERROR,message:a.translate("Generic Error."),file:c,details:d.error})})}function m(a){c.size=a.size,i?d.FileAccess.chunk({file:a,chunkSize:i},function(a){if(a.success){var b=a.value,c=b.length;j=Array(c);for(var d=0;d<c;d++)j[d]=0,k.push(b[d]);l(0,c)}}):(j=Array(1),k.push(a),l(0,1))}var f=e[c.id],h={},i=b.settings.chunk_size,j,k=[];g&&/\.(png|jpg|jpeg)$/i.test(c.name)?BrowserPlus.ImageAlter.transform({file:f,quality:g.quality||90,actions:[{scale:{maxwidth:g.width,maxheight:g.height}}]},function(a){a.success&&m(a.value.file)}):m(f)}),c({success:!0})}var d=window.BrowserPlus,e={},f=b.settings,g=f.resize;d?d.init(function(a){var b=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"},{service:"FileAccess",version:"2"}];g&&b.push({service:"ImageAlter",version:"4"}),a.success?d.require({services:b},function(a){a.success?i():c()}):c()}):c()}})}(plupload),function(a,b,c,d){function g(b,c){var d;if("FileReader"in a)d=new FileReader,d.readAsDataURL(b),d.onload=function(){c(d.result)};else return c(b.getAsDataURL())}function h(b,c){var d;if("FileReader"in a)d=new FileReader,d.readAsBinaryString(b),d.onload=function(){c(d.result)};else return c(b.getAsBinary())}function j(a,c,d,f){var h,i,j,k,n=this;g(e[a.id],function(e){h=b.createElement("canvas"),h.style.display="none",b.body.appendChild(h),i=h.getContext("2d"),j=new Image,j.onerror=j.onabort=function(){f({success:!1})},j.onload=function(){var b,g,x,y,z;c.width||(c.width=j.width),c.height||(c.height=j.height),k=Math.min(c.width/j.width,c.height/j.height);if(k<1||k===1&&d==="image/jpeg"){b=Math.round(j.width*k),g=Math.round(j.height*k),h.width=b,h.height=g,i.drawImage(j,0,0,b,g);if(d==="image/jpeg"){y=new l(atob(e.substring(e.indexOf("base64,")+7))),y.headers&&y.headers.length&&(z=new m,z.init(y.get("exif")[0])&&(z.setExif("PixelXDimension",b),z.setExif("PixelYDimension",g),y.set("exif",z.getBinary()),n.hasEventListener("ExifData")&&n.trigger("ExifData",a,z.EXIF()),n.hasEventListener("GpsData")&&n.trigger("GpsData",a,z.GPS())));if(c.quality)try{e=h.toDataURL(d,c.quality/100)}catch(A){e=h.toDataURL(d)}}else e=h.toDataURL(d);e=e.substring(e.indexOf("base64,")+7),e=atob(e),y&&y.headers&&y.headers.length&&(e=y.restore(e),y.purge()),h.parentNode.removeChild(h),f({success:!0,data:e})}else f({success:!1})},j.src=e})}function k(){function c(c,d){var e=a?0:-8*(d-1),f=0,g;for(g=0;g<d;g++)f|=b.charCodeAt(c+g)<<Math.abs(e+g*8);return f}function e(a,c,d){var d=arguments.length===3?d:b.length-c-1;b=b.substr(0,c)+a+b.substr(d+c)}function f(b,c,d){var f="",g=a?0:-8*(d-1),h;for(h=0;h<d;h++)f+=String.fromCharCode(c>>Math.abs(g+h*8)&255);e(f,b,d)}var a=!1,b;return{II:function(b){if(b===d)return a;a=b},init:function(c){a=!1,b=c},SEGMENT:function(a,c,d){switch(arguments.length){case 1:return b.substr(a,b.length-a-1);case 2:return b.substr(a,c);case 3:e(d,a,c);break;default:return b}},BYTE:function(a){return c(a,1)},SHORT:function(a){return c(a,2)},LONG:function(a,b){if(b===d)return c(a,4);f(a,b,4)},SLONG:function(a){var b=c(a,4);return b>2147483647?b-4294967296:b},STRING:function(a,b){var d="";for(b+=a;a<b;a++)d+=String.fromCharCode(c(a,1));return d}}}function l(a){var b={65505:{app:"EXIF",name:"APP1",signature:"Exif "},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE "},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0 "}},c=[],e,f,g=d,h=0,i;e=new k,e.init(a);if(e.SHORT(0)!==65496)return;f=2,i=Math.min(1048576,a.length);while(f<=i){g=e.SHORT(f);if(g>=65488&&g<=65495){f+=2;continue}if(g===65498||g===65497)break;h=e.SHORT(f+2)+2,b[g]&&e.STRING(f+4,b[g].signature.length)===b[g].signature&&c.push({hex:g,app:b[g].app.toUpperCase(),name:b[g].name.toUpperCase(),start:f,length:h,segment:e.SEGMENT(f,h)}),f+=h}return e.init(null),{headers:c,restore:function(a){e.init(a);var b=new l(a);if(!b.headers)return!1;for(var d=b.headers.length;d>0;d--){var g=b.headers[d-1];e.SEGMENT(g.start,g.length,"")}b.purge(),f=e.SHORT(2)==65504?4+e.SHORT(4):2;for(var d=0,h=c.length;d<h;d++)e.SEGMENT(f,0,c[d].segment),f+=c[d].length;return e.SEGMENT()},get:function(a){var b=[];for(var d=0,e=c.length;d<e;d++)c[d].app===a.toUpperCase()&&b.push(c[d].segment);return b},set:function(a,b){var d=[];typeof b=="string"?d.push(b):d=b;for(var e=ii=0,f=c.length;e<f;e++){c[e].app===a.toUpperCase()&&(c[e].segment=d[ii],c[e].length=d[ii].length,ii++);if(ii>=d.length)break}},purge:function(){c=[],e.init(null)}}}function m(){function g(b,c){var g=a.SHORT(b),h,i,j,k,l,m,n,p,r=[],s={};for(h=0;h<g;h++){n=m=b+12*h+2,j=c[a.SHORT(n)];if(j===d)continue;k=a.SHORT(n+=2),l=a.LONG(n+=2),n+=4,r=[];switch(k){case 1:case 7:l>4&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.BYTE(n+i);break;case 2:l>4&&(n=a.LONG(n)+e.tiffHeader),s[j]=a.STRING(n,l-1);continue;case 3:l>2&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.SHORT(n+i*2);break;case 4:l>1&&(n=a.LONG(n)+e.tiffHeader);for(i=0;i<l;i++)r[i]=a.LONG(n+i*4);break;case 5:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.LONG(n+i*4)/a.LONG(n+i*4+4);break;case 9:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.SLONG(n+i*4);break;case 10:n=a.LONG(n)+e.tiffHeader;for(i=0;i<l;i++)r[i]=a.SLONG(n+i*4)/a.SLONG(n+i*4+4);break;default:continue}p=l==1?r[0]:r,f.hasOwnProperty(j)&&typeof p!="object"?s[j]=f[j][p]:s[j]=p}return s}function h(){var c=d,f=e.tiffHeader;return a.II(a.SHORT(f)==18761),a.SHORT(f+=2)!==42?!1:(e.IFD0=e.tiffHeader+a.LONG(f+=2),c=g(e.IFD0,b.tiff),e.exifIFD="ExifIFDPointer"in c?e.tiffHeader+c.ExifIFDPointer:d,e.gpsIFD="GPSInfoIFDPointer"in c?e.tiffHeader+c.GPSInfoIFDPointer:d,!0)}function j(c,d,f){var g,h,j,k=0;if(typeof d=="string"){var l=b[c.toLowerCase()];for(hex in l)if(l[hex]===d){d=hex;break}}g=e[c.toLowerCase()+"IFD"],h=a.SHORT(g);for(i=0;i<h;i++){j=g+12*i+2;if(a.SHORT(j)==d){k=j+8;break}}return k?(a.LONG(k,f),!0):!1}var a,b,e={},f;return a=new k,b={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(b){return e={tiffHeader:10},b===d||!b.length?!1:(a.init(b),a.SHORT(0)===65505&&a.STRING(4,5).toUpperCase()==="EXIF "?h():!1)},EXIF:function(){var a;a=g(e.exifIFD,b.exif);if(a.ExifVersion&&c.typeOf(a.ExifVersion)==="array"){for(var d=0,f="";d<a.ExifVersion.length;d++)f+=String.fromCharCode(a.ExifVersion[d]);a.ExifVersion=f}return a},GPS:function(){var a;return a=g(e.gpsIFD,b.gps),a.GPSVersionID&&(a.GPSVersionID=a.GPSVersionID.join(".")),a},setExif:function(a,b){return a!=="PixelXDimension"&&a!=="PixelYDimension"?!1:j("exif",a,b)},getBinary:function(){return a.SEGMENT()}}}var e={},f;c.runtimes.Html5=c.addRuntime("html5",{getFeatures:function(){var d,e,g,h,i,j;return e=g=i=j=!1,a.XMLHttpRequest&&(d=new XMLHttpRequest,g=!!d.upload,e=!!d.sendAsBinary||!!d.upload),e&&(h=!!(d.sendAsBinary||a.Uint8Array&&a.ArrayBuffer),i=!(!File||!File.prototype.getAsDataURL&&!a.FileReader||!h),j=!!File&&!!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),f=c.ua.safari&&c.ua.windows,{html5:e,dragdrop:function(){var a=b.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a}(),jpgresize:i,pngresize:i,multipart:i||!!a.FileReader||!!a.FormData,canSendBinary:h,cantSendBlobInFormData:!!(c.ua.gecko&&a.FormData&&a.FileReader&&!FileReader.prototype.readAsArrayBuffer),progress:g,chunks:j,multi_selection:!c.ua.safari||!c.ua.windows,triggerDialog:c.ua.gecko&&a.FormData||c.ua.webkit}},init:function(d,g){function l(a){var b,f,g=[],h,i={};for(f=0;f<a.length;f++){b=a[f];if(i[b.name])continue;i[b.name]=!0,h=c.guid(),e[h]=b,g.push(new c.File(h,b.fileName||b.name,b.fileSize||b.size))}g.length&&d.trigger("FilesAdded",g)}var i,k;i=this.getFeatures();if(!i.html5){g({success:!1});return}d.bind("Init",function(a){var e,f,g=[],h,i,j=a.settings.filters,k,m,n=b.body,q;e=b.createElement("div"),e.id=a.id+"_html5_container",c.extend(e.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:d.settings.shim_bgcolor?"":0}),e.className="plupload html5",d.settings.container&&(n=b.getElementById(d.settings.container),c.getStyle(n,"position")==="static"&&(n.style.position="relative")),n.appendChild(e);r:for(h=0;h<j.length;h++){k=j[h].extensions.split(/,/);for(i=0;i<k.length;i++){if(k[i]==="*"){g=[];break r}m=c.mimeTypes[k[i]],m&&c.inArray(m,g)===-1&&g.push(m)}}e.innerHTML='<input id="'+d.id+'_html5"  style="font-size:999px" type="file" accept="'+g.join(",")+'" '+(d.settings.multi_selection&&d.features.multi_selection?'multiple="multiple"':"")+" />",e.scrollTop=100,q=b.getElementById(d.id+"_html5"),a.features.triggerDialog?c.extend(q.style,{position:"absolute",width:"100%",height:"100%"}):c.extend(q.style,{cssFloat:"right",styleFloat:"right"}),q.onchange=function(){l(this.files),this.value=""},f=b.getElementById(a.settings.browse_button);if(f){var s=a.settings.browse_button_hover,t=a.settings.browse_button_active,u=a.features.triggerDialog?f:e;s&&(c.addEvent(u,"mouseover",function(){c.addClass(f,s)},a.id),c.addEvent(u,"mouseout",function(){c.removeClass(f,s)},a.id)),t&&(c.addEvent(u,"mousedown",function(){c.addClass(f,t)},a.id),c.addEvent(b.body,"mouseup",function(){c.removeClass(f,t)},a.id)),a.features.triggerDialog&&c.addEvent(f,"click",function(c){var d=b.getElementById(a.id+"_html5");d&&!d.disabled&&d.click(),c.preventDefault()},a.id)}}),d.bind("PostInit",function(){var a=b.getElementById(d.settings.drop_element);if(a){if(f){c.addEvent(a,"dragenter",function(e){var f,g,h;f=b.getElementById(d.id+"_drop"),f||(f=b.createElement("input"),f.setAttribute("type","file"),f.setAttribute("id",d.id+"_drop"),f.setAttribute("multiple","multiple"),c.addEvent(f,"change",function(){l(this.files),c.removeEvent(f,"change",d.id),f.parentNode.removeChild(f)},d.id),a.appendChild(f)),g=c.getPos(a,b.getElementById(d.settings.container)),h=c.getSize(a),c.getStyle(a,"position")==="static"&&c.extend(a.style,{position:"relative"}),c.extend(f.style,{position:"absolute",display:"block",top:0,left:0,width:h.w+"px",height:h.h+"px",opacity:0})},d.id);return}c.addEvent(a,"drop",function(a){var b=a.dataTransfer;b&&b.files&&l(b.files),a.preventDefault()},d.id)}}),d.bind("Refresh",function(a){var e,f,g,h,i;e=b.getElementById(d.settings.browse_button),e&&(f=c.getPos(e,b.getElementById(a.settings.container)),g=c.getSize(e),h=b.getElementById(d.id+"_html5_container"),c.extend(h.style,{top:f.y+"px",left:f.x+"px",width:g.w+"px",height:g.h+"px"}),d.features.triggerDialog&&(c.getStyle(e,"position")==="static"&&c.extend(e.style,{position:"relative"}),i=parseInt(c.getStyle(e,"z-index"),10),isNaN(i)&&(i=0),c.extend(e.style,{zIndex:i}),c.extend(h.style,{zIndex:i-1})))}),d.bind("DisableBrowse",function(a,c){var d=b.getElementById(a.id+"_html5");d&&(d.disabled=c)}),d.bind("CancelUpload",function(){k.abort&&k.abort()}),d.bind("UploadFile",function(b,d){function m(a,b,c){var d;if(!File.prototype.slice)return(d=File.prototype.webkitSlice||File.prototype.mozSlice)?d.call(a,b,c):null;try{return a.slice(),a.slice(b,c)}catch(e){return a.slice(b,c-b)}}function o(e){function l(){function G(e){var f=0,j="----pluploadboundary"+c.guid(),m,p="--",v="\r\n",x="";k=new XMLHttpRequest,k.upload&&(k.upload.onprogress=function(a){d.loaded=Math.min(d.size,h+a.loaded-f),b.trigger("UploadProgress",d)}),k.onreadystatechange=function(){var a,f;if(k.readyState==4&&b.state!==c.STOPPED){try{a=k.status}catch(i){a=0}if(a>=400)b.trigger("Error",{code:c.HTTP_ERROR,message:c.translate("HTTP Error."),file:d,status:a});else{if(r){f={chunk:g,chunks:r,response:k.responseText,status:a},b.trigger("ChunkUploaded",d,f),h+=y;if(f.cancelled){d.status=c.FAILED;return}d.loaded=Math.min(d.size,(g+1)*w)}else d.loaded=d.size;b.trigger("UploadProgress",d),e=o=m=x=null,!r||++g>=r?(d.status=c.DONE,b.trigger("FileUploaded",d,{response:k.responseText,status:a})):l()}}};if(b.settings.multipart&&i.multipart){t.name=d.target_name||d.name,k.open("post",F,!0),c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)});if(typeof e!="string"&&!!a.FormData){m=new FormData,c.each(c.extend(t,b.settings.multipart_params),function(a,b){m.append(b,a)}),m.append(b.settings.file_data_name,e),k.send(m);return}if(typeof e=="string"){k.setRequestHeader("Content-Type","multipart/form-data; boundary="+j),c.each(c.extend(t,b.settings.multipart_params),function(a,b){x+=p+j+v+'Content-Disposition: form-data; name="'+b+'"'+v+v,x+=unescape(encodeURIComponent(a))+v}),E=c.mimeTypes[d.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",x+=p+j+v+'Content-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(d.name))+'"'+v+"Content-Type: "+E+v+v+e+v+p+j+p+v,f=x.length-e.length,e=x;if(k.sendAsBinary)k.sendAsBinary(e);else if(i.canSendBinary){var z=new Uint8Array(e.length);for(var A=0;A<e.length;A++)z[A]=e.charCodeAt(A)&255;k.send(z.buffer)}return}}F=c.buildUrl(b.settings.url,c.extend(t,b.settings.multipart_params)),k.open("post",F,!0),k.setRequestHeader("Content-Type","application/octet-stream"),c.each(b.settings.headers,function(a,b){k.setRequestHeader(b,a)}),k.send(e)}var o,p,r,t,w,y,E,F=b.settings.url;if(d.status==c.DONE||d.status==c.FAILED||b.state==c.STOPPED)return;t={name:d.target_name||d.name},f.chunk_size&&d.size>f.chunk_size&&(i.chunks||typeof e=="string")?(w=f.chunk_size,r=Math.ceil(d.size/w),y=Math.min(w,d.size-g*w),typeof e=="string"?o=e.substring(g*w,g*w+y):o=m(e,g*w,g*w+y),t.chunk=g,t.chunks=r):(y=d.size,o=e),b.settings.multipart&&i.multipart&&typeof o!="string"&&j&&i.cantSendBlobInFormData&&i.chunks&&b.settings.chunk_size?(j.onload=function(){G(j.result)},j.readAsBinaryString(o)):G(o)}var g=0,h=0,j="FileReader"in a?new FileReader:null;l()}var f=b.settings,g,l;g=e[d.id],i.jpgresize&&b.settings.resize&&/\.(png|jpg|jpeg)$/i.test(d.name)?j.call(b,d,b.settings.resize,/\.png$/i.test(d.name)?"image/png":"image/jpeg",function(a){a.success?(d.size=a.data.length,o(a.data)):i.chunks?o(g):h(g,o)}):!i.chunks&&i.jpgresize?h(g,o):o(g)}),d.bind("Destroy",function(a){var d,e,f=b.body,g={inputContainer:a.id+"_html5_container",inputFile:a.id+"_html5",browseButton:a.settings.browse_button,dropElm:a.settings.drop_element};for(d in g)e=b.getElementById(g[d]),e&&c.removeAllEvents(e,a.id);c.removeAllEvents(b.body,a.id),a.settings.container&&(f=b.getElementById(a.settings.container)),f.removeChild(b.getElementById(g.inputContainer))}),g({success:!0})}})}(window,document,plupload),function(a,b,c,d){function e(a){return b.getElementById(a)}c.runtimes.Html4=c.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:c.ua.gecko&&a.FormData||c.ua.webkit}},init:function(d,f){d.bind("Init",function(f){function v(){var a,h,i,j;l=c.guid(),m.push(l),a=b.createElement("form"),a.setAttribute("id","form_"+l),a.setAttribute("method","post"),a.setAttribute("enctype","multipart/form-data"),a.setAttribute("encoding","multipart/form-data"),a.setAttribute("target",f.id+"_iframe"),a.style.position="absolute",h=b.createElement("input"),h.setAttribute("id","input_"+l),h.setAttribute("type","file"),h.setAttribute("accept",o),h.setAttribute("size",1),j=e(f.settings.browse_button),f.features.triggerDialog&&j&&c.addEvent(e(f.settings.browse_button),"click",function(a){h.disabled||h.click(),a.preventDefault()},f.id),c.extend(h.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px"}),c.extend(a.style,{overflow:"hidden"}),i=f.settings.shim_bgcolor,i&&(a.style.background=i),n&&c.extend(h.style,{filter:"alpha(opacity=0)"}),c.addEvent(h,"change",function(b){var g=b.target,i,k=[],m;g.value&&(e("form_"+l).style.top="-1048575px",i=g.value.replace(/\\/g,"/"),i=i.substring(i.length,i.lastIndexOf("/")+1),k.push(new c.File(l,i)),f.features.triggerDialog?c.removeEvent(j,"click",f.id):c.removeAllEvents(a,f.id),c.removeEvent(h,"change",f.id),v(),k.length&&d.trigger("FilesAdded",k))},f.id),a.appendChild(h),g.appendChild(a),f.refresh()}function w(){var d=b.createElement("div");d.innerHTML='<iframe id="'+f.id+'_iframe" name="'+f.id+'_iframe" src="'+i+':&quot;&quot;" style="display:none"></iframe>',h=d.firstChild,g.appendChild(h),c.addEvent(h,"load",function(b){var d=b.target,e,g;if(!j)return;try{e=d.contentWindow.document||d.contentDocument||a.frames[d.id].document}catch(h){f.trigger("Error",{code:c.SECURITY_ERROR,message:c.translate("Security error."),file:j});return}g=e.body.innerHTML,g&&(j.status=c.DONE,j.loaded=1025,j.percent=100,f.trigger("UploadProgress",j),f.trigger("FileUploaded",j,{response:g}))},f.id)}var g=b.body,h,i="javascript",j,k,l,m=[],n=/MSIE/.test(navigator.userAgent),o=[],p=f.settings.filters,q,r,s,t;u:for(q=0;q<p.length;q++){r=p[q].extensions.split(/,/);for(t=0;t<r.length;t++){if(r[t]==="*"){o=[];break u}s=c.mimeTypes[r[t]],s&&c.inArray(s,o)===-1&&o.push(s)}}o=o.join(","),f.settings.container&&(g=e(f.settings.container),c.getStyle(g,"position")==="static"&&(g.style.position="relative")),f.bind("UploadFile",function(a,d){var f,g;if(d.status==c.DONE||d.status==c.FAILED||a.state==c.STOPPED)return;f=e("form_"+d.id),g=e("input_"+d.id),g.setAttribute("name",a.settings.file_data_name),f.setAttribute("action",a.settings.url),c.each(c.extend({name:d.target_name||d.name},a.settings.multipart_params),function(a,d){var e=b.createElement("input");c.extend(e,{type:"hidden",name:d,value:a}),f.insertBefore(e,f.firstChild)}),j=d,e("form_"+l).style.top="-1048575px",f.submit(),f.parentNode.removeChild(f)}),f.bind("FileUploaded",function(a){a.refresh()}),f.bind("StateChanged",function(b){b.state==c.STARTED&&w(),b.state==c.STOPPED&&a.setTimeout(function(){c.removeEvent(h,"load",b.id),h.parentNode&&h.parentNode.removeChild(h)},0)}),f.bind("Refresh",function(a){var d,f,g,h,i,j,k,m,n;d=e(a.settings.browse_button),d&&(i=c.getPos(d,e(a.settings.container)),j=c.getSize(d),k=e("form_"+l),m=e("input_"+l),c.extend(k.style,{top:i.y+"px",left:i.x+"px",width:j.w+"px",height:j.h+"px"}),a.features.triggerDialog&&(c.getStyle(d,"position")==="static"&&c.extend(d.style,{position:"relative"}),n=parseInt(d.style.zIndex,10),isNaN(n)&&(n=0),c.extend(d.style,{zIndex:n}),c.extend(k.style,{zIndex:n-1})),g=a.settings.browse_button_hover,h=a.settings.browse_button_active,f=a.features.triggerDialog?d:k,g&&(c.addEvent(f,"mouseover",function(){c.addClass(d,g)},a.id),c.addEvent(f,"mouseout",function(){c.removeClass(d,g)},a.id)),h&&(c.addEvent(f,"mousedown",function(){c.addClass(d,h)},a.id),c.addEvent(b.body,"mouseup",function(){c.removeClass(d,h)},a.id)))}),d.bind("FilesRemoved",function(a,b){var c,d;for(c=0;c<b.length;c++)d=e("form_"+b[c].id),d&&d.parentNode.removeChild(d)}),d.bind("DisableBrowse",function(a,c){var d=b.getElementById("input_"+l);d&&(d.disabled=c)}),d.bind("Destroy",function(a){var d,f,h,i={inputContainer:"form_"+l,inputFile:"input_"+l,browseButton:a.settings.browse_button};for(d in i)f=e(i[d]),f&&c.removeAllEvents(f,a.id);c.removeAllEvents(b.body,a.id),c.each(m,function(a,b){h=e("form_"+a),h&&g.removeChild(h)})}),v()}),f({success:!0})}})}(window,document,plupload),function(a,b,c,d,e,f){function u(a,b){var c=typeof a[b];return c=="function"||c=="object"&&!!a[b]||c=="unknown"}function v(a,b){return typeof a[b]=="object"&&!!a[b]}function w(a){return Object.prototype.toString.call(a)==="[object Array]"}function x(){var a="Shockwave Flash",b="application/x-shockwave-flash";if(!O(navigator.plugins)&&typeof navigator.plugins[a]=="object"){var c=navigator.plugins[a].description;c&&!O(navigator.mimeTypes)&&navigator.mimeTypes[b]&&navigator.mimeTypes[b].enabledPlugin&&(s=c.match(/\d+/g))}if(!s){var d;try{d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),s=Array.prototype.slice.call(d.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),d=null}catch(e){}}if(!s)return!1;var f=parseInt(s[0],10),g=parseInt(s[1],10);return t=f>9&&g>0,!0}function D(){if(A)return;A=!0;for(var a=0;a<B.length;a++)B[a]();B.length=0}function F(a,b){if(A){a.call(b);return}B.push(function(){a.call(b)})}function G(){var a=parent;if(m!=="")for(var b=0,c=m.split(".");b<c.length;b++)a=a[c[b]];return a.easyXDM}function H(b){return a.easyXDM=o,m=b,m&&(p="easyXDM_"+m.replace(".","_")+"_"),n}function I(a){return a.match(j)[3]}function J(a){return a.match(j)[4]||""}function K(a){var b=a.toLowerCase().match(j),c=b[2],d=b[3],e=b[4]||"";if(c=="http:"&&e==":80"||c=="https:"&&e==":443")e="";return c+"//"+d+e}function L(a){a=a.replace(l,"$1/");if(!a.match(/^(http||https):\/\//)){var b=a.substring(0,1)==="/"?"":c.pathname;b.substring(b.length-1)!=="/"&&(b=b.substring(0,b.lastIndexOf("/")+1)),a=c.protocol+"//"+c.host+b+a}while(k.test(a))a=a.replace(k,"");return a}function M(a,b){var c="",d=a.indexOf("#");d!==-1&&(c=a.substring(d),a=a.substring(0,d));var e=[];for(var g in b)b.hasOwnProperty(g)&&e.push(g+"="+f(b[g]));return a+(r?"#":a.indexOf("?")==-1?"?":"&")+e.join("&")+c}function O(a){return typeof a=="undefined"}function Q(a,b,c){var d;for(var e in b)b.hasOwnProperty(e)&&(e in a?(d=b[e],typeof d=="object"?Q(a[e],d,c):c||(a[e]=b[e])):a[e]=b[e]);return a}function R(){var a=b.body.appendChild(b.createElement("form")),c=a.appendChild(b.createElement("input"));c.name=p+"TEST"+h,q=c!==a.elements[c.name],b.body.removeChild(a)}function S(a){O(q)&&R();var c;q?c=b.createElement('<iframe name="'+a.props.name+'"/>'):(c=b.createElement("IFRAME"),c.name=a.props.name),c.id=c.name=a.props.name,delete a.props.name,typeof a.container=="string"&&(a.container=b.getElementById(a.container)),a.container||(Q(c.style,{position:"absolute",top:"-2000px",left:"0px"}),a.container=b.body);var d=a.props.src;a.props.src="javascript:false",Q(c,a.props),c.border=c.frameBorder=0,c.allowTransparency=!0,a.container.appendChild(c),a.onLoad&&y(c,"load",a.onLoad);if(a.usePost){var e=a.container.appendChild(b.createElement("form")),f;e.target=c.name,e.action=d,e.method="POST";if(typeof a.usePost=="object")for(var g in a.usePost)a.usePost.hasOwnProperty(g)&&(q?f=b.createElement('<input name="'+g+'"/>'):(f=b.createElement("INPUT"),f.name=g),f.value=a.usePost[g],e.appendChild(f));e.submit(),e.parentNode.removeChild(e)}else c.src=d;return a.props.src=d,c}function T(a,b){typeof a=="string"&&(a=[a]);var c,d=a.length;while(d--){c=a[d],c=new RegExp(c.substr(0,1)=="^"?c:"^"+c.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$");if(c.test(b))return!0}return!1}function U(d){var e=d.protocol,f;d.isHost=d.isHost||O(N.xdm_p),r=d.hash||!1,d.props||(d.props={});if(!d.isHost){d.channel=N.xdm_c.replace(/["'<>\\]/g,""),d.secret=N.xdm_s,d.remote=N.xdm_e.replace(/["'<>\\]/g,""),e=N.xdm_p;if(d.acl&&!T(d.acl,d.remote))throw new Error("Access denied for "+d.remote)}else d.remote=L(d.remote),d.channel=d.channel||"default"+h++,d.secret=Math.random().toString(16).substring(2),O(e)&&(K(c.href)==K(d.remote)?e="4":u(a,"postMessage")||u(b,"postMessage")?e="1":d.swf&&u(a,"ActiveXObject")&&x()?e="6":navigator.product==="Gecko"&&"frameElement"in a&&navigator.userAgent.indexOf("WebKit")==-1?e="5":d.remoteHelper?e="2":e="0");d.protocol=e;switch(e){case"0":Q(d,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0);if(d.isHost){if(!d.local){var g=c.protocol+"//"+c.host,i=b.body.getElementsByTagName("img"),j,k=i.length;while(k--){j=i[k];if(j.src.substring(0,g.length)===g){d.local=j.src;break}}d.local||(d.local=a)}var l={xdm_c:d.channel,xdm_p:0};d.local===a?(d.usePolling=!0,d.useParent=!0,d.local=c.protocol+"//"+c.host+c.pathname+c.search,l.xdm_e=d.local,l.xdm_pa=1):l.xdm_e=L(d.local),d.container&&(d.useResize=!1,l.xdm_po=1),d.remote=M(d.remote,l)}else Q(d,{channel:N.xdm_c,remote:N.xdm_e,useParent:!O(N.xdm_pa),usePolling:!O(N.xdm_po),useResize:d.useParent?!1:d.useResize});f=[new n.stack.HashTransport(d),new n.stack.ReliableBehavior({}),new n.stack.QueueBehavior({encode:!0,maxLength:4e3-d.remote.length}),new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"1":f=[new n.stack.PostMessageTransport(d)];break;case"2":d.remoteHelper=L(d.remoteHelper),f=[new n.stack.NameTransport(d),new n.stack.QueueBehavior,new n.stack.VerifyBehavior({initiate:d.isHost})];break;case"3":f=[new n.stack.NixTransport(d)];break;case"4":f=[new n.stack.SameOriginTransport(d)];break;case"5":f=[new n.stack.FrameElementTransport(d)];break;case"6":s||x(),f=[new n.stack.FlashTransport(d)]}return f.push(new n.stack.QueueBehavior({lazy:d.lazy,remove:!0})),f}function V(a){var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var d=0,e=a.length;d<e;d++)b=a[d],Q(b,c,!0),d!==0&&(b.down=a[d-1]),d!==e-1&&(b.up=a[d+1]);return b}function W(a){a.up.down=a.down,a.down.up=a.up,a.up=a.down=null}var g=this,h=Math.floor(Math.random()*1e4),i=Function.prototype,j=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,k=/[\-\w]+\/\.\.\//,l=/([^:])\/\//g,m="",n={},o=a.easyXDM,p="easyXDM_",q,r=!1,s,t,y,z;if(u(a,"addEventListener"))y=function(a,b,c){a.addEventListener(b,c,!1)},z=function(a,b,c){a.removeEventListener(b,c,!1)};else if(u(a,"attachEvent"))y=function(a,b,c){a.attachEvent("on"+b,c)},z=function(a,b,c){a.detachEvent("on"+b,c)};else throw new Error("Browser not supported");var A=!1,B=[],C;"readyState"in b?(C=b.readyState,A=C=="complete"||~navigator.userAgent.indexOf("AppleWebKit/")&&(C=="loaded"||C=="interactive")):A=!!b.body;if(!A){if(u(a,"addEventListener"))y(b,"DOMContentLoaded",D);else{y(b,"readystatechange",function(){b.readyState=="complete"&&D()});if(b.documentElement.doScroll&&a===top){var E=function(){if(A)return;try{b.documentElement.doScroll("left")}catch(a){d(E,1);return}D()};E()}}y(a,"load",D)}var N=function(a){a=a.substring(1).split("&");var b={},c,d=a.length;while(d--)c=a[d].split("="),b[c[0]]=e(c[1]);return b}(/xdm_e=/.test(c.search)?c.search:c.hash),P=function(){var a={},b={a:[1,2,3]},c='{"a":[1,2,3]}';return typeof JSON!="undefined"&&typeof JSON.stringify=="function"&&JSON.stringify(b).replace(/\s/g,"")===c?JSON:(Object.toJSON&&Object.toJSON(b).replace(/\s/g,"")===c&&(a.stringify=Object.toJSON),typeof String.prototype.evalJSON=="function"&&(b=c.evalJSON(),b.a&&b.a.length===3&&b.a[2]===3&&(a.parse=function(a){return a.evalJSON()})),a.stringify&&a.parse?(P=function(){return a},a):null)};Q(n,{version:"2.4.15.0",query:N,stack:{},apply:Q,getJSONObject:P,whenReady:F,noConflict:H}),n.DomHelper={on:y,un:z,requiresJSON:function(c){v(a,"JSON")||b.write('<script type="text/javascript" src="'+c+'"></script>')}},function(){var a={};n.Fn={set:function(b,c){a[b]=c},get:function(b,c){var d=a[b];return c&&delete a[b],d}}}(),n.Socket=function(a){var b=V(U(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){a.onReady&&a.onReady(b)}}])),c=K(a.remote);this.origin=K(a.remote),this.destroy=function(){b.destroy()},this.postMessage=function(a){b.outgoing(a,c)},b.init()},n.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];typeof d=="function"&&(b.local[c]={method:d})}var e=V(U(a).concat([new n.stack.RpcBehavior(this,b),{callback:function(b){a.onReady&&a.onReady(b)}}]));this.origin=K(a.remote),this.destroy=function(){e.destroy()},e.init()},n.stack.SameOriginTransport=function(a){var b,e,f,g;return b={outgoing:function(a,b,c){f(a),c&&c()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=K(a.remote),a.isHost?(Q(a.props,{src:M(a.remote,{xdm_e:c.protocol+"//"+c.host+c.pathname,xdm_c:a.channel,xdm_p:4}),name:p+a.channel+"_provider"}),e=S(a),n.Fn.set(a.channel,function(a){return f=a,d(function(){b.up.callback(!0)},0),function(a){b.up.incoming(a,g)}})):(f=G().Fn.get(a.channel,!0)(function(a){b.up.incoming(a,g)}),d(function(){b.up.callback(!0)},0))},init:function(){F(b.onDOMReady,b)}}},n.stack.FlashTransport=function(a){function l(a,b){d(function(){e.up.incoming(a,i)},0)}function o(c){var d=a.swf+"?host="+a.isHost,e="easyXDM_swf_"+Math.floor(Math.random()*1e4);n.Fn.set("flash_loaded"+c.replace(/[\-.]/g,"_"),function(){n.stack.FlashTransport[c].swf=j=k.firstChild;var a=n.stack.FlashTransport[c].queue;for(var b=0;b<a.length;b++)a[b]();a.length=0}),a.swfContainer?k=typeof a.swfContainer=="string"?b.getElementById(a.swfContainer):a.swfContainer:(k=b.createElement("div"),Q(k.style,t&&a.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),b.body.appendChild(k));var f="callback=flash_loaded"+c.replace(/[\-.]/g,"_")+"&proto="+g.location.protocol+"&domain="+I(g.location.href)+"&port="+J(g.location.href)+"&ns="+m;k.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+e+"' data='"+d+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+d+"'></param><param name='flashvars' value='"+f+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+f+"' allowScriptAccess='always' wmode='transparent' src='"+d+"' height='1' width='1'></embed></object>"}var e,f,h,i,j,k;return e={outgoing:function(b,c,d){j.postMessage(a.channel,b.toString()),d&&d()},destroy:function(){try{j.destroyChannel(a.channel)}catch(b){}j=null,f&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){i=a.remote,n.Fn.set("flash_"+a.channel+"_init",function(){d(function(){e.up.callback(!0)})}),n.Fn.set("flash_"+a.channel+"_onMessage",l),a.swf=L(a.swf);var b=I(a.swf),g=function(){n.stack.FlashTransport[b].init=!0,j=n.stack.FlashTransport[b].swf,j.createChannel(a.channel,a.secret,K(a.remote),a.isHost),a.isHost&&(t&&a.swfNoThrottle&&Q(a.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),Q(a.props,{src:M(a.remote,{xdm_e:K(c.href),xdm_c:a.channel,xdm_p:6,xdm_s:a.secret}),name:p+a.channel+"_provider"}),f=S(a))};n.stack.FlashTransport[b]&&n.stack.FlashTransport[b].init?g():n.stack.FlashTransport[b]?n.stack.FlashTransport[b].queue.push(g):(n.stack.FlashTransport[b]={queue:[g]},o(b))},init:function(){F(e.onDOMReady,e)}}},n.stack.PostMessageTransport=function(b){function i(a){if(a.origin)return K(a.origin);if(a.uri)return K(a.uri);if(a.domain)return c.protocol+"//"+a.domain;throw"Unable to retrieve the origin of the event"}function j(a){var c=i(a);c==h&&a.data.substring(0,b.channel.length+1)==b.channel+" "&&e.up.incoming(a.data.substring(b.channel.length+1),c)}var e,f,g,h;return e={outgoing:function(a,c,d){g.postMessage(b.channel+" "+a,c||h),d&&d()},destroy:function(){z(a,"message",j),f&&(g=null,f.parentNode.removeChild(f),f=null)},onDOMReady:function(){h=K(b.remote);if(b.isHost){var i=function(c){c.data==b.channel+"-ready"&&(g="postMessage"in f.contentWindow?f.contentWindow:f.contentWindow.document,z(a,"message",i),y(a,"message",j),d(function(){e.up.callback(!0)},0))};y(a,"message",i),Q(b.props,{src:M(b.remote,{xdm_e:K(c.href),xdm_c:b.channel,xdm_p:1}),name:p+b.channel+"_provider"}),f=S(b)}else y(a,"message",j),g="postMessage"in a.parent?a.parent:a.parent.document,g.postMessage(b.channel+"-ready",h),d(function(){e.up.callback(!0)},0)},init:function(){F(e.onDOMReady,e)}}},n.stack.FrameElementTransport=function(e){var f,g,h,i;return f={outgoing:function(a,b,c){h.call(this,a),c&&c()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=K(e.remote),e.isHost?(Q(e.props,{src:M(e.remote,{xdm_e:K(c.href),xdm_c:e.channel,xdm_p:5}),name:p+e.channel+"_provider"}),g=S(e),g.fn=function(a){return delete g.fn,h=a,d(function(){f.up.callback(!0)},0),function(a){f.up.incoming(a,i)}}):(b.referrer&&K(b.referrer)!=N.xdm_e&&(a.top.location=N.xdm_e),h=a.frameElement.fn(function(a){f.up.incoming(a,i)}),f.up.callback(!0))},init:function(){F(f.onDOMReady,f)}}},n.stack.NameTransport=function(a){function k(b){var d=a.remoteHelper+(c?"#_3":"#_2")+a.channel;e.contentWindow.sendMessage(b,d)}function l(){c?(++g===2||!c)&&b.up.callback(!0):(k("ready"),b.up.callback(!0))}function m(a){b.up.incoming(a,i)}function o(){h&&d(function(){h(!0)},0)}var b,c,e,f,g,h,i,j;return b={outgoing:function(a,b,c){h=c,k(a)},destroy:function(){e.parentNode.removeChild(e),e=null,c&&(f.parentNode.removeChild(f),f=null)},onDOMReady:function(){c=a.isHost,g=0,i=K(a.remote),a.local=L(a.local),c?(n.Fn.set(a.channel,function(b){c&&b==="ready"&&(n.Fn.set(a.channel,m),l())}),j=M(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),Q(a.props,{src:j+"#"+a.channel,name:p+a.channel+"_provider"}),f=S(a)):(a.remoteHelper=a.remote,n.Fn.set(a.channel,m));var b=function(){var c=e||this;z(c,"load",b),n.Fn.set(a.channel+"_load",o),function f(){typeof c.contentWindow.sendMessage=="function"?l():d(f,50)}()};e=S({props:{src:a.local+"#_4"+a.channel},onLoad:b})},init:function(){F(b.onDOMReady,b)}}},n.stack.HashTransport=function(b){function o(a){if(!l)return;var c=b.remote+"#"+j++ +"_"+a;(f||!m?l.contentWindow:l).location=c}function q(a){i=a,c.up.incoming(i.substring(i.indexOf("_")+1),n)}function r(){if(!k)return;var a=k.location.href,b="",c=a.indexOf("#");c!=-1&&(b=a.substring(c)),b&&b!=i&&q(b)}function s(){g=setInterval(r,h)}var c,e=this,f,g,h,i,j,k,l,m,n;return c={outgoing:function(a,b){o(a)},destroy:function(){a.clearInterval(g),(f||!m)&&l.parentNode.removeChild(l),l=null},onDOMReady:function(){f=b.isHost,h=b.interval,i="#"+b.channel,j=0,m=b.useParent,n=K(b.remote);if(f){Q(b.props,{src:b.remote,name:p+b.channel+"_provider"});if(m)b.onLoad=function(){k=a,s(),c.up.callback(!0)};else{var e=0,g=b.delay/50;(function o(){if(++e>g)throw new Error("Unable to reference listenerwindow");try{k=l.contentWindow.frames[p+b.channel+"_consumer"]}catch(a){}k?(s(),c.up.callback(!0)):d(o,50)})()}l=S(b)}else k=a,s(),m?(l=parent,c.up.callback(!0)):(Q(b,{props:{src:b.remote+"#"+b.channel+new Date,name:p+b.channel+"_consumer"},onLoad:function(){c.up.callback(!0)}}),l=S(b))},init:function(){F(c.onDOMReady,c)}}},n.stack.ReliableBehavior=function(a){var b,c,d=0,e=0,f="";return b={incoming:function(a,g){var h=a.indexOf("_"),i=a.substring(0,h).split(",");a=a.substring(h+1),i[0]==d&&(f="",c&&(c(!0),c=null)),a.length>0&&(b.down.outgoing(i[1]+","+d+"_"+f,g),e!=i[1]&&(e=i[1],b.up.incoming(a,g)))},outgoing:function(a,g,h){f=a,c=h,b.down.outgoing(e+","+ ++d+"_"+a,g)}}},n.stack.QueueBehavior=function(a){function m(){if(a.remove&&c.length===0){W(b);return}if(g||c.length===0||i)return;g=!0;var e=c.shift();b.down.outgoing(e.data,e.origin,function(a){g=!1,e.callback&&d(function(){e.callback(a)},0),m()})}var b,c=[],g=!0,h="",i,j=0,k=!1,l=!1;return b={init:function(){O(a)&&(a={}),a.maxLength&&(j=a.maxLength,l=!0),a.lazy?k=!0:b.down.init()},callback:function(a){g=!1;var c=b.up;m(),c.callback(a)},incoming:function(c,d){if(l){var f=c.indexOf("_"),g=parseInt(c.substring(0,f),10);h+=c.substring(f+1),g===0&&(a.encode&&(h=e(h)),b.up.incoming(h,d),h="")}else b.up.incoming(c,d)},outgoing:function(d,e,g){a.encode&&(d=f(d));var h=[],i;if(l){while(d.length!==0)i=d.substring(0,j),d=d.substring(i.length),h.push(i);while(i=h.shift())c.push({data:h.length+"_"+i,origin:e,callback:h.length===0?g:null})}else c.push({data:d,origin:e,callback:g});k?b.down.init():m()},destroy:function(){i=!0,b.down.destroy()}}},n.stack.VerifyBehavior=function(a){function f(){c=Math.random().toString(16).substring(2),b.down.outgoing(c)}var b,c,d,e=!1;return b={incoming:function(e,g){var h=e.indexOf("_");h===-1?e===c?b.up.callback(!0):d||(d=e,a.initiate||f(),b.down.outgoing(e)):e.substring(0,h)===d&&b.up.incoming(e.substring(h+1),g)},outgoing:function(a,d,e){b.down.outgoing(c+"_"+a,d,e)},callback:function(b){a.initiate&&f()}}},n.stack.RpcBehavior=function(a,b){function g(a){a.jsonrpc="2.0",c.down.outgoing(d.stringify(a))}function h(a,b){var c=Array.prototype.slice;return function(){var d=arguments.length,h,i={method:b};d>0&&typeof arguments[d-1]=="function"?(d>1&&typeof arguments[d-2]=="function"?(h={success:arguments[d-2],error:arguments[d-1]},i.params=c.call(arguments,0,d-2)):(h={success:arguments[d-1]},i.params=c.call(arguments,0,d-1)),f[""+ ++e]=h,i.id=e):i.params=c.call(arguments,0),a.namedParams&&i.params.length===1&&(i.params=i.params[0]),g(i)}}function j(a,b,c,d){if(!c){b&&g({id:b,error:{code:-32601,message:"Procedure not found."}});return}var e,f;b?(e=function(a){e=i,g({id:b,result:a})},f=function(a,c){f=i;var d={id:b,error:{code:-32099,message:a}};c&&(d.error.data=c),g(d)}):e=f=i,w(d)||(d=[d]);try{var h=c.method.apply(c.scope,d.concat([e,f]));O(h)||e(h)}catch(j){f(j.message)}}var c,d=b.serializer||P(),e=0,f={};return c={incoming:function(a,c){var e=d.parse(a);if(e.method)b.handle?b.handle(e,g):j(e.method,e.id,b.local[e.method],e.params);else{var h=f[e.id];e.error?h.error&&h.error(e.error):h.success&&h.success(e.result),delete f[e.id]}},init:function(){if(b.remote)for(var d in b.remote)b.remote.hasOwnProperty(d)&&(a[d]=h(b.remote[d],d));c.down.init()},destroy:function(){for(var d in b.remote)b.remote.hasOwnProperty(d)&&a.hasOwnProperty(d)&&delete a[d];c.down.destroy()}}},g.easyXDM=n}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent)};chute(".chute-widget:not(.chute-loaded)");